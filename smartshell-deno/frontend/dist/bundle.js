var M=class h{static instance;events=new Map;constructor(){}static getInstance(){return h.instance||(h.instance=new h),h.instance}subscribe(e,t){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t),()=>this.unsubscribe(e,t)}publish(e,t){if(!this.events.has(e))return;this.events.get(e).forEach(i=>{try{i(t)}catch(n){console.error(`Error in event handler for ${e}:`,n)}})}unsubscribe(e,t){this.events.has(e)&&(this.events.get(e).delete(t),this.events.get(e).size===0&&this.events.delete(e))}clear(){this.events.clear()}},l=M.getInstance(),c={USER_LOGIN:"user:login",USER_LOGOUT:"user:logout",SESSION_EXPIRED:"session:expired",HOSTS_LOADED:"hosts:loaded",BOOKINGS_LOADED:"bookings:loaded",GAMES_LOADED:"games:loaded",MODAL_OPEN:"modal:open",MODAL_CLOSE:"modal:close",TOAST_SHOW:"toast:show",BOOKING_CREATED:"booking:created",BOOKING_CANCELLED:"booking:cancelled",BOOKING_SELECTED:"booking:selected",GROUP_FILTER_CHANGED:"filter:group:changed",GAME_FILTER_CHANGED:"filter:game:changed",ERROR_OCCURRED:"error:occurred",NETWORK_ERROR:"error:network"};var R=class h{static instance;state;subscribers=new Map;constructor(){this.state=this.getInitialState()}static getInstance(){return h.instance||(h.instance=new h),h.instance}getInitialState(){return{auth:{isAuthenticated:!1,user:null,sessionId:null},hosts:[],bookings:[],games:[],achievements:[],payments:null,leaderboard:null,ui:{selectedGroup:"",selectedHosts:new Set,hoveredHost:null,loading:{hosts:!1,bookings:!1,games:!1,achievements:!1,payments:!1,leaderboard:!1},modals:{login:!1,booking:!1,pcInfo:!1,games:!1,leaderboard:!1},filters:{gameGroup:"",popularOnly:!1}},map:{scale:48,offsetX:0,offsetY:0,padding:36}}}getState(){return this.state}getStateSlice(e){return this.state[e]}setState(e){let t={...this.state};this.state=this.mergeDeep(this.state,e),this.notifySubscribers(),this.emitStateEvents(t,this.state)}setStateSlice(e,t){this.setState({[e]:t})}subscribe(e){let t=Date.now().toString();return this.subscribers.has("all")||this.subscribers.set("all",new Set),this.subscribers.get("all").add(e),e(this.state),()=>{this.subscribers.get("all")?.delete(e)}}subscribeToSlice(e,t){return this.subscribers.has(e)||this.subscribers.set(e,new Set),this.subscribers.get(e).add(t),t(this.state[e]),()=>{this.subscribers.get(e)?.delete(t)}}notifySubscribers(){this.subscribers.get("all")?.forEach(e=>{try{e(this.state)}catch(t){console.error("Error in state subscriber:",t)}}),this.subscribers.forEach((e,t)=>{t!=="all"&&e.forEach(s=>{try{s(this.state[t])}catch(i){console.error(`Error in ${t} subscriber:`,i)}})})}emitStateEvents(e,t){e.auth.isAuthenticated!==t.auth.isAuthenticated&&(t.auth.isAuthenticated?l.publish(c.USER_LOGIN,t.auth.user):l.publish(c.USER_LOGOUT,{})),e.hosts!==t.hosts&&t.hosts.length>0&&l.publish(c.HOSTS_LOADED,t.hosts),e.bookings!==t.bookings&&t.bookings.length>0&&l.publish(c.BOOKINGS_LOADED,t.bookings),e.games!==t.games&&t.games.length>0&&l.publish(c.GAMES_LOADED,t.games),e.ui.selectedGroup!==t.ui.selectedGroup&&l.publish(c.GROUP_FILTER_CHANGED,t.ui.selectedGroup)}mergeDeep(e,t){let s={...e};return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach(i=>{this.isObject(t[i])?i in e?s[i]=this.mergeDeep(e[i],t[i]):Object.assign(s,{[i]:t[i]}):Object.assign(s,{[i]:t[i]})}),s}isObject(e){return e&&typeof e=="object"&&!Array.isArray(e)}reset(){this.state=this.getInitialState(),this.notifySubscribers()}},m=R.getInstance();var f=class{baseUrl;defaultHeaders;constructor(e=""){this.baseUrl=e,this.defaultHeaders={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}getAuthToken(){let e=localStorage.getItem("sessionId");return console.log(`[ApiService] getAuthToken - Token ${e?"found":"not found"} in localStorage`),e}prepareHeaders(e){let t={...this.defaultHeaders};if(e?.skipAuth)console.log("[ApiService] prepareHeaders - skipAuth is true, skipping Authorization header");else{let s=this.getAuthToken();s?(t.Authorization=`Bearer ${s}`,console.log("[ApiService] prepareHeaders - Adding Authorization header")):console.log("[ApiService] prepareHeaders - No token available, skipping Authorization header")}return e?.headers&&Object.assign(t,e.headers),t}async handleErrors(e,t){if(e.ok)return;if(e.status===401){l.publish(c.SESSION_EXPIRED,{status:e.status}),localStorage.removeItem("sessionId"),localStorage.removeItem("user"),t?.skipErrorHandling||l.publish(c.MODAL_OPEN,{type:"login",message:"Session expired. Please login again."});return}let s=`HTTP ${e.status}`;try{let i=await e.json();s=i.error||i.message||s}catch{s=e.statusText||s}throw t?.skipErrorHandling||l.publish(c.ERROR_OCCURRED,{message:s,status:e.status}),new Error(s)}async request(e,t){let s=e.startsWith("http")?e:`${this.baseUrl}${e}`,i=this.prepareHeaders(t);try{let n=await fetch(s,{...t,headers:i});await this.handleErrors(n,t);let o=n.headers.get("content-type");return o&&o.includes("application/json")?await n.json():n.text()}catch(n){throw n instanceof Error&&l.publish(c.NETWORK_ERROR,{message:n.message,endpoint:e}),n}}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,s){return this.request(e,{...s,method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t,s){return this.request(e,{...s,method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}async upload(e,t,s,i){let n=new FormData;n.append("file",t),s&&Object.entries(s).forEach(([d,g])=>{n.append(d,String(g))});let o=this.prepareHeaders(i);return delete o["Content-Type"],this.request(e,{...i,method:"POST",body:n,headers:o})}},Q=new f,H=class extends f{async login(e){return this.post("/api/login",e,{skipAuth:!0})}async logout(){return this.post("/api/logout")}},O=class extends f{async getHosts(){return this.get("/api/hosts",{cache:"no-store"})}async getHost(e){return this.get(`/api/hosts/${e}`)}},w=class extends f{async getBookings(){return this.get("/api/bookings",{cache:"no-store"})}async createBooking(e){return this.post("/api/bookings",e)}async cancelBooking(e){return this.delete(`/api/bookings/${e}`)}},I=class extends f{async getGames(){return this.get("/api/shortcuts",{cache:"no-store"})}},k=class extends f{async getAchievements(){return this.get("/api/achievements")}},D=class extends f{async getPayments(){return this.get("/api/payments")}},A=class extends f{async getLeaderboard(){return this.get("/api/leaderboard",{cache:"no-store"})}},Z=new H,B=new O,N=new w,ee=new I,U=new k,G=new D,te=new A;var P=class{components=[];isInitialized=!1;constructor(){this.init()}async init(){if(!this.isInitialized)try{this.restoreSession(),this.setupEventListeners(),await this.loadInitialData(),this.setupAutoRefresh(),this.isInitialized=!0,console.log("App initialized successfully")}catch(e){console.error("Failed to initialize app:",e),this.handleError(e)}}restoreSession(){let e=localStorage.getItem("sessionId"),t=localStorage.getItem("user");if(e&&t)try{let s=JSON.parse(t);m.setStateSlice("auth",{isAuthenticated:!0,sessionId:e,user:s}),this.updateUserInfo(s),l.publish(c.USER_LOGIN,s)}catch(s){console.error("Failed to restore session:",s),localStorage.removeItem("sessionId"),localStorage.removeItem("user")}}setupEventListeners(){l.subscribe(c.USER_LOGIN,e=>{this.updateUserInfo(e)}),l.subscribe(c.USER_LOGOUT,()=>{this.clearUserInfo()}),l.subscribe(c.SESSION_EXPIRED,()=>{this.clearUserInfo(),l.publish(c.MODAL_OPEN,{type:"login",message:"Session expired. Please login again."})}),l.subscribe(c.ERROR_OCCURRED,e=>{this.showError(e.message)}),l.subscribe(c.NETWORK_ERROR,e=>{this.showError(`Network error: ${e.message}`)}),l.subscribe(c.MODAL_OPEN,e=>{this.openModal(e.type,e.message)}),l.subscribe(c.MODAL_CLOSE,e=>{this.closeModal(e.type)}),window.addEventListener("resize",()=>{this.handleResize()}),window.addEventListener("beforeunload",()=>{this.cleanup()})}async loadInitialData(){try{m.setStateSlice("ui",{...m.getStateSlice("ui"),loading:{...m.getStateSlice("ui").loading,hosts:!0,bookings:!0,games:!1,achievements:!1,payments:!1,leaderboard:!1}});let[e,t]=await Promise.all([B.getHosts(),N.getBookings()]);m.setState({hosts:e,bookings:t}),m.setStateSlice("ui",{...m.getStateSlice("ui"),loading:{...m.getStateSlice("ui").loading,hosts:!1,bookings:!1}}),m.getStateSlice("auth").isAuthenticated&&await this.loadUserData()}catch(e){console.error("Failed to load initial data:",e),this.handleError(e)}}async loadUserData(){try{m.setStateSlice("ui",{...m.getStateSlice("ui"),loading:{...m.getStateSlice("ui").loading,achievements:!0,payments:!0}});let[e,t]=await Promise.all([U.getAchievements(),G.getPayments()]);m.setState({achievements:e,payments:t}),m.setStateSlice("ui",{...m.getStateSlice("ui"),loading:{...m.getStateSlice("ui").loading,achievements:!1,payments:!1}})}catch(e){console.error("Failed to load user data:",e),this.handleError(e)}}setupAutoRefresh(){setInterval(async()=>{try{let[e,t]=await Promise.all([B.getHosts(),N.getBookings()]);m.setState({hosts:e,bookings:t})}catch(e){console.error("Failed to refresh data:",e)}},3e4)}mount(){let e=document.getElementById("refresh");e&&e.addEventListener("click",()=>{this.loadInitialData(),this.showError("Refreshing data...")});let t=document.getElementById("authBtn");t&&t.addEventListener("click",()=>{this.getState().auth.isAuthenticated?(localStorage.removeItem("sessionId"),localStorage.removeItem("user"),m.setStateSlice("auth",{isAuthenticated:!1,user:null,sessionId:null}),l.publish(c.USER_LOGOUT,{})):l.publish(c.MODAL_OPEN,{type:"login"})});let s=document.getElementById("groupFilter")}handleResize(){l.publish(c.GROUP_FILTER_CHANGED,m.getStateSlice("ui").selectedGroup)}updateUserInfo(e){let t=document.getElementById("userInfo"),s=document.getElementById("authBtn");if(t&&e){let i=((e.deposit||0)+(e.bonus||0)).toFixed(2);t.innerHTML=`<i class="fas fa-user"></i> ${e.nickname||""} \u2022 <i class="fas fa-wallet" style="font-size:0.75rem;"></i> ${i}\u20AC`}s&&(s.innerHTML='<i class="fas fa-sign-out-alt"></i> <span class="hide-mobile">Logout</span>')}clearUserInfo(){let e=document.getElementById("userInfo"),t=document.getElementById("authBtn");e&&(e.innerHTML=""),t&&(t.innerHTML='<i class="fas fa-user-circle"></i> <span class="hide-mobile">Login</span>')}openModal(e,t){let s=document.getElementById(`${e}Modal`)||document.getElementById(e);if(s&&(s.style.display="flex",t&&e==="login")){let i=document.getElementById("loginError");i&&(i.textContent=t)}}closeModal(e){let t=document.getElementById(`${e}Modal`)||document.getElementById(e);t&&(t.style.display="none")}showError(e){l.publish(c.TOAST_SHOW,{type:"error",message:e})}handleError(e){console.error("App error:",e),this.showError(e.message||"An error occurred")}cleanup(){this.components.forEach(e=>{e&&typeof e.destroy=="function"&&e.destroy()}),this.components=[]}getState(){return m.getState()}addComponent(e){this.components.push(e)}removeComponent(e){let t=this.components.indexOf(e);t>-1&&(this.components.splice(t,1),e.destroy())}},_=new P;var L=class{element;children=[];eventUnsubscribers=[];stateUnsubscribers=[];props={};isDestroyed=!1;constructor(e){if(typeof e.element=="string"){if(this.element=document.querySelector(e.element),!this.element)throw new Error(`Element not found: ${e.element}`)}else e.element?this.element=e.element:this.element=this.createElement();this.props=e.props||{},e.template&&(this.element.innerHTML=e.template),e.styles&&this.applyStyles(e.styles),this.init()}createElement(){let e=this.getTemplate();if(!e)return document.createElement("div");let t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild||t}getTemplate(){return""}applyStyles(e){if(this.element.id){let t=document.getElementById(`style-${this.element.id}`);t||(t=document.createElement("style"),t.id=`style-${this.element.id}`,document.head.appendChild(t)),t.textContent=e}else{let t=document.createElement("style");t.textContent=e,document.head.appendChild(t),this.eventUnsubscribers.push(()=>{document.head.removeChild(t)})}}init(){this.bindEvents(),this.subscribeToState(),this.subscribeToEvents(),this.onInit()}bindEvents(){}subscribeToState(){}subscribeToEvents(){}onInit(){}onDestroy(){}subscribeToStateSlice(e,t){let s=m.subscribeToSlice(e,t);this.stateUnsubscribers.push(s)}subscribeToEvent(e,t){let s=l.subscribe(e,t);this.eventUnsubscribers.push(s)}getState(){return m.getState()}getStateSlice(e){return m.getStateSlice(e)}setState(e){m.setState(e)}setStateSlice(e,t){m.setStateSlice(e,t)}publishEvent(e,t){l.publish(e,t)}findElement(e){return this.element.querySelector(e)}findElements(e){return Array.from(this.element.querySelectorAll(e))}addChild(e){this.children.push(e),this.element.appendChild(e.element)}removeChild(e){let t=this.children.indexOf(e);t>-1&&(this.children.splice(t,1),e.destroy())}show(){this.element.style.display="",this.onShow()}hide(){this.element.style.display="none",this.onHide()}onShow(){}onHide(){}setProp(e,t){this.props[e]=t,this.onPropChange(e,t)}getProp(e){return this.props[e]}onPropChange(e,t){}render(){this.beforeRender(),this.doRender(),this.afterRender()}beforeRender(){}doRender(){}afterRender(){}destroy(){this.isDestroyed||(this.onDestroy(),this.children.forEach(e=>e.destroy()),this.children=[],this.eventUnsubscribers.forEach(e=>e()),this.eventUnsubscribers=[],this.stateUnsubscribers.forEach(e=>e()),this.stateUnsubscribers=[],this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.isDestroyed=!0)}isComponentDestroyed(){return this.isDestroyed}};var C=class extends L{canvas=null;ctx=null;animationFrameId=null;resizeTimeout=null;constructor(){super({element:"#mapCard"})}onInit(){if(this.canvas=this.findElement("#map"),!this.canvas){console.error("Map canvas not found");return}if(this.ctx=this.canvas.getContext("2d"),!this.ctx){console.error("Failed to get canvas context");return}this.setupCanvas(),this.bindEvents(),this.subscribeToState(),this.draw()}setupCanvas(){!this.canvas||!this.ctx||(this.resizeCanvas(),this.setupCanvasEvents())}resizeCanvas(){if(!this.canvas)return;let e=this.canvas.getBoundingClientRect(),t=window.devicePixelRatio||1;this.canvas.width=Math.floor(e.width*t),this.canvas.height=Math.floor(e.height*t),this.ctx&&this.ctx.setTransform(t,0,0,t,0,0)}setupCanvasEvents(){this.canvas&&(this.canvas.addEventListener("mousemove",e=>{this.handleMouseMove(e)}),this.canvas.addEventListener("click",e=>{this.handleClick(e)}))}bindEvents(){window.addEventListener("resize",()=>{this.handleResize()})}subscribeToState(){this.subscribeToStateSlice("hosts",()=>{this.draw()}),this.subscribeToStateSlice("bookings",()=>{this.draw()}),this.subscribeToStateSlice("ui",e=>{this.draw()}),this.subscribeToStateSlice("map",()=>{this.draw()})}handleMouseMove(e){if(!this.canvas)return;let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=this.getHostAtPosition(s,i),o=this.getState();o.ui.hoveredHost!==n&&this.setStateSlice("ui",{...o.ui,hoveredHost:n}),this.canvas.style.cursor=n?"pointer":"default",this.showTooltip(n,e.clientX,e.clientY)}handleClick(e){if(!this.canvas)return;let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=this.getHostAtPosition(s,i);if(!n)return;let o=this.getState();if(e.ctrlKey||e.metaKey){if(!n.session){let d=new Set(o.ui.selectedHosts);d.has(n.id)?d.delete(n.id):d.add(n.id),this.setStateSlice("ui",{...o.ui,selectedHosts:d}),this.publishEvent(c.BOOKING_SELECTED,{hostIds:Array.from(d)})}}else this.publishEvent(c.MODAL_OPEN,{type:"pcInfo",data:n})}handleResize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.setStateSlice("map",{...this.getStateSlice("map")}),this.draw()},100)}getHostAtPosition(e,t){let s=this.getState(),i=this.getFilteredHosts(s.hosts,s.ui.selectedGroup),n=this.computeBounds(i);for(let o of i){if(!Number.isFinite(o.coord_x)||!Number.isFinite(o.coord_y))continue;let d=o.coord_x-n.minX,g=o.coord_y-n.minY,r=s.map,a=r.scale,u=r.offsetX,p=r.offsetY,b=u+d*a+a/2,v=p+g*a+a/2,S=Math.max(a-8,36),E=Math.max(a-8,38),y=b-S/2,T=v-E/2;if(e>=y&&e<=y+S&&t>=T&&t<=T+E)return o}return null}getFilteredHosts(e,t){return t?e.filter(s=>s.group?.id===t):e}computeBounds(e){let t=e.filter(n=>Number.isFinite(n.coord_x)&&Number.isFinite(n.coord_y));if(!t.length)return{minX:0,minY:0,maxX:1,maxY:1};let s=t.map(n=>n.coord_x),i=t.map(n=>n.coord_y);return{minX:Math.min(...s),minY:Math.min(...i),maxX:Math.max(...s),maxY:Math.max(...i)}}fitToView(){let e=this.getState(),t=this.getFilteredHosts(e.hosts,e.ui.selectedGroup),s=this.computeBounds(t),i=e.map,n=i.padding;if(!this.canvas)return;let o=this.canvas.getBoundingClientRect(),d=s.maxX-s.minX+1||1,g=s.maxY-s.minY+1||1,r=(o.width-n*2)/d,a=(o.height-n*2)/g,u=Math.max(28,Math.floor(Math.min(r,a))),p=d*u,b=g*u,v=n+Math.floor((o.width-n*2-p)/2),S=n+Math.floor((o.height-n*2-b)/2);this.setStateSlice("map",{...i,scale:u,offsetX:v,offsetY:S})}getColorForHost(e){let t=this.getState();return e.session?getComputedStyle(document.documentElement).getPropertyValue("--busy").trim()||"#3b82f6":t.bookings.some(i=>i.hosts.some(n=>n.id==e.id))?getComputedStyle(document.documentElement).getPropertyValue("--booked").trim()||"#f59e0b":getComputedStyle(document.documentElement).getPropertyValue("--free").trim()||"#10b981"}getStatusEmoji(e){let t=this.getState();if(e.session)return"\u25CF";let s=new Date;return t.bookings.some(o=>{let d=new Date(o.from),g=new Date(o.to);return o.hosts.some(r=>r.id==e.id)&&d<=s&&g>s})?"\u25C6":t.bookings.some(o=>{let d=new Date(o.from);return o.hosts.some(g=>g.id==e.id)&&d>s})?"\u25C7":"\u25CB"}showTooltip(e,t,s){let i=document.getElementById("tooltip");if(!i)return;if(!e){i.style.display="none";return}let n=`${this.getStatusEmoji(e)} ${e.alias??"Seat "+e.id}`;e.group?.title&&(n+=` \u2022 ${e.group.title}`);let o=this.getState(),d=new Date,g=o.bookings.find(r=>{let a=new Date(r.from),u=new Date(r.to);return r.hosts.some(p=>p.id==e.id)&&a<=d&&u>d});if(g){let r=new Date(g.from),a=new Date(g.to),u=r.toLocaleDateString("en-US",{day:"numeric",month:"short"}),p=r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),b=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});n+=`<br>\u25C6 Booked: ${u}, ${p} - ${b}`,g.client?.nickname&&(n+=` (${g.client.nickname})`)}else{let r=o.bookings.find(a=>{let u=new Date(a.from);return a.hosts.some(p=>p.id==e.id)&&u>d});if(r){let a=new Date(r.from),u=a.toLocaleDateString("en-US",{day:"numeric",month:"short"}),p=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});n+=`<br>\u25C7 Future: ${u}, ${p}`,r.client?.nickname&&(n+=` (${r.client.nickname})`)}}if(e.session){n+=e.session.user?`<br>\u25CF Playing: ${e.session.user}`:"<br>\u25CF In Use";let r=null;if(e.session.time_left&&e.session.time_left>0)r=e.session.time_left;else if(e.session.started_at&&e.session.duration){let a=new Date(e.session.started_at),u=new Date(a.getTime()+e.session.duration*1e3);r=Math.max(0,Math.floor((u.getTime()-Date.now())/1e3))}if(r&&r>0){let a=Math.floor(r/3600),u=Math.floor(r%3600/60);n+=a>0?`<br>\u23F1 Remaining: ${a}h ${u}m`:`<br>\u23F1 Remaining: ${u}m`}}i.innerHTML=n,i.style.display="block",requestAnimationFrame(()=>{let r=i.getBoundingClientRect(),a=20,u=t+a,p=s+a;u+r.width>window.innerWidth-10&&(u=t-r.width-a),p+r.height>window.innerHeight-10&&(p=s-r.height-a),i.style.left=u+"px",i.style.top=p+"px"})}draw(){!this.canvas||!this.ctx||(this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>{this.resizeCanvas();let e=this.getState(),t=this.getFilteredHosts(e.hosts,e.ui.selectedGroup),s=this.canvas.getBoundingClientRect();this.ctx.clearRect(0,0,s.width,s.height),this.ctx.fillStyle="#07121b",this.ctx.fillRect(0,0,s.width,s.height),this.draw._fittedOnce||(this.fitToView(),this.draw._fittedOnce=!0);let i=this.computeBounds(t),n=e.map;this.ctx.strokeStyle="rgba(255,255,255,0.03)",this.ctx.lineWidth=1;for(let o=i.minX;o<=i.maxX+1;o++){let d=n.offsetX+(o-i.minX)*n.scale;this.ctx.beginPath(),this.ctx.moveTo(d,n.offsetY),this.ctx.lineTo(d,s.height-n.offsetY),this.ctx.stroke()}for(let o=i.minY;o<=i.maxY+1;o++){let d=n.offsetY+(o-i.minY)*n.scale;this.ctx.beginPath(),this.ctx.moveTo(n.offsetX,d),this.ctx.lineTo(s.width-n.offsetX,d),this.ctx.stroke()}this.ctx.textBaseline="middle",this.ctx.font="12px Inter, system-ui";for(let o of t){if(!Number.isFinite(o.coord_x)||!Number.isFinite(o.coord_y))continue;let d=o.coord_x-i.minX,g=o.coord_y-i.minY,r=n.offsetX+d*n.scale+n.scale/2,a=n.offsetY+g*n.scale+n.scale/2,u=Math.max(n.scale-8,36),p=Math.max(n.scale-8,38),b=r-u/2,v=a-p/2,S=e.ui.hoveredHost&&e.ui.hoveredHost.id===o.id,E=e.ui.selectedHosts.has(o.id);this.ctx.fillStyle=this.getColorForHost(o),S&&(this.ctx.globalAlpha=.85),this.roundRect(b,v,u,p,8),this.ctx.fill(),this.ctx.globalAlpha=1,E&&(this.ctx.strokeStyle="#00bcd4",this.ctx.lineWidth=3,this.roundRect(b,v,u,p,8),this.ctx.stroke());let y=this.getStatusEmoji(o);this.ctx.font="16px Arial",this.ctx.fillStyle="#ffffff";let T=this.ctx.measureText(y).width;this.ctx.fillText(y,r-T/2,a-8),this.ctx.font="11px Inter, system-ui",this.ctx.fillStyle="#061226";let $=o.alias??"\u2014";if(this.clipText($,b+8,a+8,u-16),o.session){this.ctx.fillStyle="rgba(184,195,211,0.9)";let x="";if(o.session.time_left&&o.session.time_left>0)x="\u0434\u043E "+new Date(Date.now()+o.session.time_left*1e3).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});else if(o.session.started_at&&o.session.duration){let F=new Date(o.session.started_at);x="\u0434\u043E "+new Date(F.getTime()+o.session.duration*1e3).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}x&&this.clipText(x,b+8,a+18,u-16)}}}))}roundRect(e,t,s,i,n){if(!this.ctx)return;let o=Math.min(n,s/2,i/2);this.ctx.beginPath(),this.ctx.moveTo(e+o,t),this.ctx.arcTo(e+s,t,e+s,t+i,o),this.ctx.arcTo(e+s,t+i,e,t+i,o),this.ctx.arcTo(e,t+i,e,t,o),this.ctx.arcTo(e,t,e+s,t,o),this.ctx.closePath()}clipText(e,t,s,i){if(!this.ctx)return;let n=String(e??"");for(;this.ctx.measureText(n).width>i&&n.length>1;)n=n.slice(0,-1);n!==e&&i>10&&(n=n.slice(0,-1)+"\u2026"),this.ctx.fillText(n,t,s)}destroy(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId);let e=document.getElementById("tooltip");e&&(e.style.display="none"),super.destroy()}};function K(){q(),_.mount()}async function X(){try{let e=await(await fetch("../templates/main.html")).text();document.body&&(document.body.innerHTML=e);let s=await(await fetch("../templates/modals.html")).text(),i=document.createElement("div");i.innerHTML=s,document.body.appendChild(i)}catch(h){console.error("Failed to load templates:",h)}}function q(){let h=new C;_.addComponent(h)}function z(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{X().then(K)}):X().then(K)}z();export{_ as app,K as initializeFrontend};
//# sourceMappingURL=bundle.js.map
