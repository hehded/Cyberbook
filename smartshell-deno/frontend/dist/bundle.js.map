{
  "version": 3,
  "sources": ["../../src/frontend/events/EventBus.ts", "../../src/frontend/state/StateStore.ts", "../../src/frontend/services/ApiService.ts", "../../src/frontend/modules/App.ts", "../../src/frontend/components/BaseComponent.ts", "../../src/frontend/modules/MapComponent.ts", "../../src/frontend/index.ts"],
  "sourcesContent": ["/**\r\n * EventBus implementation using Observer pattern\r\n * Provides decoupled communication between components\r\n */\r\nexport interface IEventBus {\r\n  subscribe<T>(event: string, callback: (data: T) => void): () => void;\r\n  publish<T>(event: string, data: T): void;\r\n  unsubscribe(event: string, callback: Function): void;\r\n  clear(): void;\r\n}\r\n\r\nexport class EventBus implements IEventBus {\r\n  private static instance: EventBus;\r\n  private events: Map<string, Set<Function>> = new Map();\r\n\r\n  private constructor() {}\r\n\r\n  /**\r\n   * Singleton pattern implementation\r\n   */\r\n  public static getInstance(): EventBus {\r\n    if (!EventBus.instance) {\r\n      EventBus.instance = new EventBus();\r\n    }\r\n    return EventBus.instance;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an event\r\n   * @param event Event name\r\n   * @param callback Callback function\r\n   * @returns Unsubscribe function\r\n   */\r\n  subscribe<T>(event: string, callback: (data: T) => void): () => void {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n\r\n    this.events.get(event)!.add(callback);\r\n\r\n    // Return unsubscribe function\r\n    return () => this.unsubscribe(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Publish an event\r\n   * @param event Event name\r\n   * @param data Event data\r\n   */\r\n  publish<T>(event: string, data: T): void {\r\n    if (!this.events.has(event)) {\r\n      return;\r\n    }\r\n\r\n    const callbacks = this.events.get(event)!;\r\n    callbacks.forEach(callback => {\r\n      try {\r\n        callback(data);\r\n      } catch (error) {\r\n        console.error(`Error in event handler for ${event}:`, error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from an event\r\n   * @param event Event name\r\n   * @param callback Callback function\r\n   */\r\n  unsubscribe(event: string, callback: Function): void {\r\n    if (!this.events.has(event)) {\r\n      return;\r\n    }\r\n\r\n    this.events.get(event)!.delete(callback);\r\n    \r\n    // Clean up empty event sets\r\n    if (this.events.get(event)!.size === 0) {\r\n      this.events.delete(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all event subscriptions\r\n   */\r\n  clear(): void {\r\n    this.events.clear();\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const eventBus = EventBus.getInstance();\r\n\r\n// Event type definitions for type safety\r\nexport const EVENTS = {\r\n  // Authentication events\r\n  USER_LOGIN: 'user:login',\r\n  USER_LOGOUT: 'user:logout',\r\n  SESSION_EXPIRED: 'session:expired',\r\n  \r\n  // Data events\r\n  HOSTS_LOADED: 'hosts:loaded',\r\n  BOOKINGS_LOADED: 'bookings:loaded',\r\n  GAMES_LOADED: 'games:loaded',\r\n  \r\n  // UI events\r\n  MODAL_OPEN: 'modal:open',\r\n  MODAL_CLOSE: 'modal:close',\r\n  TOAST_SHOW: 'toast:show',\r\n  \r\n  // Booking events\r\n  BOOKING_CREATED: 'booking:created',\r\n  BOOKING_CANCELLED: 'booking:cancelled',\r\n  BOOKING_SELECTED: 'booking:selected',\r\n  \r\n  // Filter events\r\n  GROUP_FILTER_CHANGED: 'filter:group:changed',\r\n  GAME_FILTER_CHANGED: 'filter:game:changed',\r\n  \r\n  // Error events\r\n  ERROR_OCCURRED: 'error:occurred',\r\n  NETWORK_ERROR: 'error:network',\r\n} as const;\r\n\r\nexport type EventType = typeof EVENTS[keyof typeof EVENTS];", "/**\r\n * State management using Observer pattern\r\n * Provides centralized state with reactive updates\r\n */\r\n\r\nimport { eventBus, EVENTS } from '../events/EventBus.ts';\r\n\r\nexport interface State {\r\n  // Authentication state\r\n  auth: {\r\n    isAuthenticated: boolean;\r\n    user: any | null;\r\n    sessionId: string | null;\r\n  };\r\n  \r\n  // Data state\r\n  hosts: any[];\r\n  bookings: any[];\r\n  games: any[];\r\n  achievements: any[];\r\n  payments: any;\r\n  leaderboard: any;\r\n  \r\n  // UI state\r\n  ui: {\r\n    selectedGroup: string;\r\n    selectedHosts: Set<number>;\r\n    hoveredHost: any | null;\r\n    loading: {\r\n      hosts: boolean;\r\n      bookings: boolean;\r\n      games: boolean;\r\n      achievements: boolean;\r\n      payments: boolean;\r\n      leaderboard: boolean;\r\n    };\r\n    modals: {\r\n      login: boolean;\r\n      booking: boolean;\r\n      pcInfo: boolean;\r\n      games: boolean;\r\n      leaderboard: boolean;\r\n    };\r\n    filters: {\r\n      gameGroup: string;\r\n      popularOnly: boolean;\r\n    };\r\n  };\r\n  \r\n  // Map state\r\n  map: {\r\n    scale: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    padding: number;\r\n  };\r\n}\r\n\r\n/**\r\n * State Store class implementing Observer pattern\r\n */\r\nexport class StateStore {\r\n  private static instance: StateStore;\r\n  private state: State;\r\n  private subscribers: Map<string, Set<(state: State) => void>> = new Map();\r\n\r\n  private constructor() {\r\n    this.state = this.getInitialState();\r\n  }\r\n\r\n  /**\r\n   * Singleton pattern\r\n   */\r\n  public static getInstance(): StateStore {\r\n    if (!StateStore.instance) {\r\n      StateStore.instance = new StateStore();\r\n    }\r\n    return StateStore.instance;\r\n  }\r\n\r\n  /**\r\n   * Get initial state\r\n   */\r\n  private getInitialState(): State {\r\n    return {\r\n      auth: {\r\n        isAuthenticated: false,\r\n        user: null,\r\n        sessionId: null,\r\n      },\r\n      hosts: [],\r\n      bookings: [],\r\n      games: [],\r\n      achievements: [],\r\n      payments: null,\r\n      leaderboard: null,\r\n      ui: {\r\n        selectedGroup: '',\r\n        selectedHosts: new Set(),\r\n        hoveredHost: null,\r\n        loading: {\r\n          hosts: false,\r\n          bookings: false,\r\n          games: false,\r\n          achievements: false,\r\n          payments: false,\r\n          leaderboard: false,\r\n        },\r\n        modals: {\r\n          login: false,\r\n          booking: false,\r\n          pcInfo: false,\r\n          games: false,\r\n          leaderboard: false,\r\n        },\r\n        filters: {\r\n          gameGroup: '',\r\n          popularOnly: false,\r\n        },\r\n      },\r\n      map: {\r\n        scale: 48,\r\n        offsetX: 0,\r\n        offsetY: 0,\r\n        padding: 36,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get current state\r\n   */\r\n  public getState(): State {\r\n    return this.state;\r\n  }\r\n\r\n  /**\r\n   * Get specific state slice\r\n   */\r\n  public getStateSlice<K extends keyof State>(key: K): State[K] {\r\n    return this.state[key];\r\n  }\r\n\r\n  /**\r\n   * Update state with new values\r\n   */\r\n  public setState(updates: Partial<State>): void {\r\n    const prevState = { ...this.state };\r\n    \r\n    // Deep merge updates\r\n    this.state = this.mergeDeep(this.state, updates);\r\n    \r\n    // Notify subscribers\r\n    this.notifySubscribers();\r\n    \r\n    // Emit specific events for state changes\r\n    this.emitStateEvents(prevState, this.state);\r\n  }\r\n\r\n  /**\r\n   * Update specific state slice\r\n   */\r\n  public setStateSlice<K extends keyof State>(\r\n    key: K, \r\n    value: State[K]\r\n  ): void {\r\n    this.setState({ [key]: value } as Partial<State>);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  public subscribe(callback: (state: State) => void): () => void {\r\n    const id = Date.now().toString();\r\n    \r\n    if (!this.subscribers.has('all')) {\r\n      this.subscribers.set('all', new Set());\r\n    }\r\n    \r\n    this.subscribers.get('all')!.add(callback);\r\n    \r\n    // Call immediately with current state\r\n    callback(this.state);\r\n    \r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.subscribers.get('all')?.delete(callback);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Subscribe to specific state slice\r\n   */\r\n  public subscribeToSlice<K extends keyof State>(\r\n    key: K,\r\n    callback: (value: State[K]) => void\r\n  ): () => void {\r\n    if (!this.subscribers.has(key)) {\r\n      this.subscribers.set(key, new Set());\r\n    }\r\n    \r\n    this.subscribers.get(key)!.add(callback);\r\n    \r\n    // Call immediately with current value\r\n    callback(this.state[key]);\r\n    \r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.subscribers.get(key)?.delete(callback);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Notify all subscribers\r\n   */\r\n  private notifySubscribers(): void {\r\n    // Notify all subscribers\r\n    this.subscribers.get('all')?.forEach(callback => {\r\n      try {\r\n        callback(this.state);\r\n      } catch (error) {\r\n        console.error('Error in state subscriber:', error);\r\n      }\r\n    });\r\n    \r\n    // Notify slice subscribers\r\n    this.subscribers.forEach((subscribers, key) => {\r\n      if (key !== 'all') {\r\n        subscribers.forEach(callback => {\r\n          try {\r\n            callback(this.state[key as keyof State]);\r\n          } catch (error) {\r\n            console.error(`Error in ${key} subscriber:`, error);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Emit events for specific state changes\r\n   */\r\n  private emitStateEvents(prevState: State, newState: State): void {\r\n    // Authentication events\r\n    if (prevState.auth.isAuthenticated !== newState.auth.isAuthenticated) {\r\n      if (newState.auth.isAuthenticated) {\r\n        eventBus.publish(EVENTS.USER_LOGIN, newState.auth.user);\r\n      } else {\r\n        eventBus.publish(EVENTS.USER_LOGOUT, {});\r\n      }\r\n    }\r\n\r\n    // Data events\r\n    if (prevState.hosts !== newState.hosts && newState.hosts.length > 0) {\r\n      eventBus.publish(EVENTS.HOSTS_LOADED, newState.hosts);\r\n    }\r\n    \r\n    if (prevState.bookings !== newState.bookings && newState.bookings.length > 0) {\r\n      eventBus.publish(EVENTS.BOOKINGS_LOADED, newState.bookings);\r\n    }\r\n    \r\n    if (prevState.games !== newState.games && newState.games.length > 0) {\r\n      eventBus.publish(EVENTS.GAMES_LOADED, newState.games);\r\n    }\r\n\r\n    // UI events\r\n    if (prevState.ui.selectedGroup !== newState.ui.selectedGroup) {\r\n      eventBus.publish(EVENTS.GROUP_FILTER_CHANGED, newState.ui.selectedGroup);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deep merge objects\r\n   */\r\n  private mergeDeep(target: any, source: any): any {\r\n    const output = { ...target };\r\n    \r\n    if (this.isObject(target) && this.isObject(source)) {\r\n      Object.keys(source).forEach(key => {\r\n        if (this.isObject(source[key])) {\r\n          if (!(key in target)) {\r\n            Object.assign(output, { [key]: source[key] });\r\n          } else {\r\n            output[key] = this.mergeDeep(target[key], source[key]);\r\n          }\r\n        } else {\r\n          Object.assign(output, { [key]: source[key] });\r\n        }\r\n      });\r\n    }\r\n    \r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Check if value is an object\r\n   */\r\n  private isObject(item: any): boolean {\r\n    return item && typeof item === 'object' && !Array.isArray(item);\r\n  }\r\n\r\n  /**\r\n   * Reset state to initial values\r\n   */\r\n  public reset(): void {\r\n    this.state = this.getInitialState();\r\n    this.notifySubscribers();\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const stateStore = StateStore.getInstance();\r\n\r\n// Selector functions for common state access patterns\r\nexport const selectors = {\r\n  // Authentication selectors\r\n  isAuthenticated: (state: State) => state.auth.isAuthenticated,\r\n  currentUser: (state: State) => state.auth.user,\r\n  \r\n  // Data selectors\r\n  allHosts: (state: State) => state.hosts,\r\n  allBookings: (state: State) => state.bookings,\r\n  allGames: (state: State) => state.games,\r\n  \r\n  // UI selectors\r\n  selectedGroup: (state: State) => state.ui.selectedGroup,\r\n  selectedHosts: (state: State) => state.ui.selectedHosts,\r\n  isLoading: (state: State, key: keyof State['ui']['loading']) => \r\n    state.ui.loading[key],\r\n  \r\n  // Computed selectors\r\n  availableHosts: (state: State) => \r\n    state.hosts.filter(host => !host.session),\r\n  busyHosts: (state: State) => \r\n    state.hosts.filter(host => host.session),\r\n  bookedHosts: (state: State) => {\r\n    const bookedHostIds = new Set();\r\n    state.bookings.forEach(booking => {\r\n      booking.hosts.forEach((host: any) => {\r\n        const hostInState = state.hosts.find(h => h.id === host.id);\r\n        if (hostInState && !hostInState.session) {\r\n          bookedHostIds.add(host.id);\r\n        }\r\n      });\r\n    });\r\n    return state.hosts.filter(host => bookedHostIds.has(host.id));\r\n  },\r\n};", "/**\r\n * API Service layer for frontend-backend communication\r\n * Implements proper error handling and request/response processing\r\n */\r\n\r\nimport { eventBus, EVENTS } from '../events/EventBus.ts';\r\n\r\nexport interface ApiResponse<T = any> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  message?: string;\r\n}\r\n\r\nexport interface RequestOptions extends RequestInit {\r\n  skipAuth?: boolean;\r\n  skipErrorHandling?: boolean;\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  items: T[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\n/**\r\n * Base API service with common functionality\r\n */\r\nexport class ApiService {\r\n  private baseUrl: string;\r\n  private defaultHeaders: Record<string, string>;\r\n\r\n  constructor(baseUrl: string = '') {\r\n    this.baseUrl = baseUrl;\r\n    this.defaultHeaders = {\r\n      'Content-Type': 'application/json',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get authentication token from localStorage\r\n   */\r\n  private getAuthToken(): string | null {\r\n    const token = localStorage.getItem('sessionId');\r\n    console.log(`[ApiService] getAuthToken - Token ${token ? 'found' : 'not found'} in localStorage`);\r\n    return token;\r\n  }\r\n\r\n  /**\r\n   * Prepare request headers\r\n   */\r\n  private prepareHeaders(options?: RequestOptions): Record<string, string> {\r\n    const headers = { ...this.defaultHeaders };\r\n\r\n    // Add auth token if not skipped\r\n    if (!options?.skipAuth) {\r\n      const token = this.getAuthToken();\r\n      if (token) {\r\n        headers['Authorization'] = `Bearer ${token}`;\r\n        console.log(`[ApiService] prepareHeaders - Adding Authorization header`);\r\n      } else {\r\n        console.log(`[ApiService] prepareHeaders - No token available, skipping Authorization header`);\r\n      }\r\n    } else {\r\n      console.log(`[ApiService] prepareHeaders - skipAuth is true, skipping Authorization header`);\r\n    }\r\n\r\n    // Merge with additional headers\r\n    if (options?.headers) {\r\n      Object.assign(headers, options.headers as Record<string, string>);\r\n    }\r\n\r\n    return headers;\r\n  }\r\n\r\n  /**\r\n   * Handle API errors\r\n   */\r\n  private async handleErrors(response: Response, options?: RequestOptions): Promise<void> {\r\n    if (response.ok) return;\r\n\r\n    // Handle authentication errors\r\n    if (response.status === 401) {\r\n      eventBus.publish(EVENTS.SESSION_EXPIRED, { status: response.status });\r\n      localStorage.removeItem('sessionId');\r\n      localStorage.removeItem('user');\r\n      \r\n      if (!options?.skipErrorHandling) {\r\n        eventBus.publish(EVENTS.MODAL_OPEN, { \r\n          type: 'login',\r\n          message: 'Session expired. Please login again.' \r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Handle other HTTP errors\r\n    let errorMessage = `HTTP ${response.status}`;\r\n    try {\r\n      const errorData = await response.json();\r\n      errorMessage = errorData.error || errorData.message || errorMessage;\r\n    } catch (e) {\r\n      // If parsing fails, use status text\r\n      errorMessage = response.statusText || errorMessage;\r\n    }\r\n\r\n    if (!options?.skipErrorHandling) {\r\n      eventBus.publish(EVENTS.ERROR_OCCURRED, { \r\n        message: errorMessage,\r\n        status: response.status \r\n      });\r\n    }\r\n\r\n    throw new Error(errorMessage);\r\n  }\r\n\r\n  /**\r\n   * Make HTTP request with proper error handling\r\n   */\r\n  private async request<T>(\r\n    endpoint: string,\r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    const url = endpoint.startsWith('http') \r\n      ? endpoint \r\n      : `${this.baseUrl}${endpoint}`;\r\n\r\n    const headers = this.prepareHeaders(options);\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers,\r\n      });\r\n\r\n      await this.handleErrors(response, options);\r\n\r\n      // Handle empty responses\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType && contentType.includes('application/json')) {\r\n        return await response.json();\r\n      }\r\n      \r\n      return response.text() as unknown as T;\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        eventBus.publish(EVENTS.NETWORK_ERROR, { \r\n          message: error.message,\r\n          endpoint \r\n        });\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * GET request\r\n   */\r\n  async get<T>(endpoint: string, options?: RequestOptions): Promise<T> {\r\n    return this.request<T>(endpoint, { \r\n      ...options, \r\n      method: 'GET' \r\n    });\r\n  }\r\n\r\n  /**\r\n   * POST request\r\n   */\r\n  async post<T>(\r\n    endpoint: string, \r\n    data?: any, \r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      ...options,\r\n      method: 'POST',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * PUT request\r\n   */\r\n  async put<T>(\r\n    endpoint: string, \r\n    data?: any, \r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      ...options,\r\n      method: 'PUT',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * DELETE request\r\n   */\r\n  async delete<T>(endpoint: string, options?: RequestOptions): Promise<T> {\r\n    return this.request<T>(endpoint, { \r\n      ...options, \r\n      method: 'DELETE' \r\n    });\r\n  }\r\n\r\n  /**\r\n   * Upload file\r\n   */\r\n  async upload<T>(\r\n    endpoint: string, \r\n    file: File, \r\n    additionalData?: Record<string, any>,\r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    \r\n    if (additionalData) {\r\n      Object.entries(additionalData).forEach(([key, value]) => {\r\n        formData.append(key, String(value));\r\n      });\r\n    }\r\n\r\n    const headers = this.prepareHeaders(options);\r\n    // Remove content-type to let browser set it with boundary\r\n    delete headers['Content-Type'];\r\n\r\n    return this.request<T>(endpoint, {\r\n      ...options,\r\n      method: 'POST',\r\n      body: formData,\r\n      headers,\r\n    });\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nexport const apiService = new ApiService();\r\n\r\n/**\r\n * Specialized API services\r\n */\r\nexport class AuthApiService extends ApiService {\r\n  async login(credentials: { login: string; password: string }) {\r\n    return this.post<ApiResponse>('/api/login', credentials, { skipAuth: true });\r\n  }\r\n\r\n  async logout() {\r\n    return this.post<ApiResponse>('/api/logout');\r\n  }\r\n}\r\n\r\nexport class HostApiService extends ApiService {\r\n  async getHosts() {\r\n    return this.get<any[]>('/api/hosts', { cache: 'no-store' });\r\n  }\r\n\r\n  async getHost(id: number) {\r\n    return this.get<any>(`/api/hosts/${id}`);\r\n  }\r\n}\r\n\r\nexport class BookingApiService extends ApiService {\r\n  async getBookings() {\r\n    return this.get<any[]>('/api/bookings', { cache: 'no-store' });\r\n  }\r\n\r\n  async createBooking(bookingData: any) {\r\n    return this.post<ApiResponse>('/api/bookings', bookingData);\r\n  }\r\n\r\n  async cancelBooking(id: number) {\r\n    return this.delete<ApiResponse>(`/api/bookings/${id}`);\r\n  }\r\n}\r\n\r\nexport class GameApiService extends ApiService {\r\n  async getGames() {\r\n    return this.get<any[]>('/api/shortcuts', { cache: 'no-store' });\r\n  }\r\n}\r\n\r\nexport class AchievementApiService extends ApiService {\r\n  async getAchievements() {\r\n    return this.get<any[]>('/api/achievements');\r\n  }\r\n}\r\n\r\nexport class PaymentApiService extends ApiService {\r\n  async getPayments() {\r\n    return this.get<any>('/api/payments');\r\n  }\r\n}\r\n\r\nexport class LeaderboardApiService extends ApiService {\r\n  async getLeaderboard() {\r\n    return this.get<any>('/api/leaderboard', { cache: 'no-store' });\r\n  }\r\n}\r\n\r\n// Export service instances\r\nexport const authApi = new AuthApiService();\r\nexport const hostApi = new HostApiService();\r\nexport const bookingApi = new BookingApiService();\r\nexport const gameApi = new GameApiService();\r\nexport const achievementApi = new AchievementApiService();\r\nexport const paymentApi = new PaymentApiService();\r\nexport const leaderboardApi = new LeaderboardApiService();", "/**\r\n * Main Application Module\r\n * Initializes and coordinates all frontend components\r\n */\r\n\r\nimport { eventBus, EVENTS } from '../events/EventBus.ts';\r\nimport { stateStore, State, selectors } from '../state/StateStore.ts';\r\nimport { BaseComponent } from '../components/BaseComponent.ts';\r\nimport { hostApi, bookingApi, gameApi, achievementApi, paymentApi, leaderboardApi } from '../services/ApiService.ts';\r\n\r\n// Import components\r\nimport { MapComponent } from './MapComponent.ts';\r\nimport {\r\n  LoginComponent,\r\n  BookingComponent,\r\n  HostComponent,\r\n  PaymentComponent,\r\n  ProfileComponent,\r\n  ModalComponent\r\n} from '../components/index.ts';\r\n\r\n/**\r\n * Main Application Class\r\n */\r\nexport class App {\r\n  private components: BaseComponent[] = [];\r\n  private isInitialized = false;\r\n\r\n  constructor() {\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initialize application\r\n   */\r\n  private async init(): Promise<void> {\r\n    if (this.isInitialized) return;\r\n\r\n    try {\r\n      // Restore session from localStorage\r\n      this.restoreSession();\r\n\r\n      // Initialize event listeners\r\n      this.setupEventListeners();\r\n\r\n      // Load initial data\r\n      await this.loadInitialData();\r\n\r\n      // Setup auto-refresh\r\n      this.setupAutoRefresh();\r\n\r\n      this.isInitialized = true;\r\n      console.log('App initialized successfully');\r\n    } catch (error) {\r\n      console.error('Failed to initialize app:', error);\r\n      this.handleError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore user session from localStorage\r\n   */\r\n  private restoreSession(): void {\r\n    const sessionId = localStorage.getItem('sessionId');\r\n    const userStr = localStorage.getItem('user');\r\n    \r\n    if (sessionId && userStr) {\r\n      try {\r\n        const user = JSON.parse(userStr);\r\n        stateStore.setStateSlice('auth', {\r\n          isAuthenticated: true,\r\n          sessionId,\r\n          user\r\n        });\r\n\r\n        // Update UI\r\n        this.updateUserInfo(user);\r\n        eventBus.publish(EVENTS.USER_LOGIN, user);\r\n      } catch (error) {\r\n        console.error('Failed to restore session:', error);\r\n        localStorage.removeItem('sessionId');\r\n        localStorage.removeItem('user');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup global event listeners\r\n   */\r\n  private setupEventListeners(): void {\r\n    // Authentication events\r\n    eventBus.subscribe(EVENTS.USER_LOGIN, (user) => {\r\n      this.updateUserInfo(user);\r\n    });\r\n\r\n    eventBus.subscribe(EVENTS.USER_LOGOUT, () => {\r\n      this.clearUserInfo();\r\n    });\r\n\r\n    eventBus.subscribe(EVENTS.SESSION_EXPIRED, () => {\r\n      this.clearUserInfo();\r\n      eventBus.publish(EVENTS.MODAL_OPEN, { \r\n        type: 'login',\r\n        message: 'Session expired. Please login again.' \r\n      });\r\n    });\r\n\r\n    // Error events\r\n    eventBus.subscribe(EVENTS.ERROR_OCCURRED, (data: { message: string }) => {\r\n      this.showError(data.message);\r\n    });\r\n\r\n    eventBus.subscribe(EVENTS.NETWORK_ERROR, (data: { message: string }) => {\r\n      this.showError(`Network error: ${data.message}`);\r\n    });\r\n\r\n    // Modal events - now handled by ModalComponent\r\n    // These are kept for backward compatibility with existing code\r\n    eventBus.subscribe(EVENTS.MODAL_OPEN, (data: { type: string; message?: string }) => {\r\n      this.openModal(data.type, data.message);\r\n    });\r\n\r\n    eventBus.subscribe(EVENTS.MODAL_CLOSE, (data: { type: string }) => {\r\n      this.closeModal(data.type);\r\n    });\r\n\r\n    // Window events\r\n    window.addEventListener('resize', () => {\r\n      this.handleResize();\r\n    });\r\n\r\n    window.addEventListener('beforeunload', () => {\r\n      this.cleanup();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load initial data\r\n   */\r\n  private async loadInitialData(): Promise<void> {\r\n    try {\r\n      // Set loading states\r\n      stateStore.setStateSlice('ui', {\r\n        ...stateStore.getStateSlice('ui'),\r\n        loading: {\r\n          ...stateStore.getStateSlice('ui').loading,\r\n          hosts: true,\r\n          bookings: true,\r\n          games: false,\r\n          achievements: false,\r\n          payments: false,\r\n          leaderboard: false,\r\n        }\r\n      });\r\n\r\n      // Load data in parallel\r\n      const [hosts, bookings] = await Promise.all([\r\n        hostApi.getHosts(),\r\n        bookingApi.getBookings()\r\n      ]);\r\n\r\n      // Update state with loaded data\r\n      stateStore.setState({\r\n        hosts,\r\n        bookings\r\n      });\r\n\r\n      // Update loading states\r\n      stateStore.setStateSlice('ui', {\r\n        ...stateStore.getStateSlice('ui'),\r\n        loading: {\r\n          ...stateStore.getStateSlice('ui').loading,\r\n          hosts: false,\r\n          bookings: false\r\n        }\r\n      });\r\n\r\n      // Load user-specific data if authenticated\r\n      if (stateStore.getStateSlice('auth').isAuthenticated) {\r\n        await this.loadUserData();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load initial data:', error);\r\n      this.handleError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load user-specific data\r\n   */\r\n  private async loadUserData(): Promise<void> {\r\n    try {\r\n      // Set loading states\r\n      stateStore.setStateSlice('ui', {\r\n        ...stateStore.getStateSlice('ui'),\r\n        loading: {\r\n          ...stateStore.getStateSlice('ui').loading,\r\n          achievements: true,\r\n          payments: true\r\n        }\r\n      });\r\n\r\n      // Load data in parallel\r\n      const [achievements, payments] = await Promise.all([\r\n        achievementApi.getAchievements(),\r\n        paymentApi.getPayments()\r\n      ]);\r\n\r\n      // Update state\r\n      stateStore.setState({\r\n        achievements,\r\n        payments\r\n      });\r\n\r\n      // Update loading states\r\n      stateStore.setStateSlice('ui', {\r\n        ...stateStore.getStateSlice('ui'),\r\n        loading: {\r\n          ...stateStore.getStateSlice('ui').loading,\r\n          achievements: false,\r\n          payments: false\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to load user data:', error);\r\n      this.handleError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup auto-refresh intervals\r\n   */\r\n  private setupAutoRefresh(): void {\r\n    // Refresh data every 30 seconds\r\n    setInterval(async () => {\r\n      try {\r\n        const [hosts, bookings] = await Promise.all([\r\n          hostApi.getHosts(),\r\n          bookingApi.getBookings()\r\n        ]);\r\n\r\n        stateStore.setState({\r\n          hosts,\r\n          bookings\r\n        });\r\n      } catch (error) {\r\n        console.error('Failed to refresh data:', error);\r\n      }\r\n    }, 30000);\r\n  }\r\n\r\n  /**\r\n   * Mount application to DOM (bind UI events)\r\n   */\r\n  public mount(): void {\r\n    // Bind header buttons\r\n    const refreshBtn = document.getElementById('refresh');\r\n    if (refreshBtn) {\r\n      refreshBtn.addEventListener('click', () => {\r\n        this.loadInitialData();\r\n        this.showError('Refreshing data...'); // Using toast for feedback\r\n      });\r\n    }\r\n\r\n    const authBtn = document.getElementById('authBtn');\r\n    if (authBtn) {\r\n      authBtn.addEventListener('click', () => {\r\n        const state = this.getState();\r\n        if (state.auth.isAuthenticated) {\r\n          // Logout\r\n          localStorage.removeItem('sessionId');\r\n          localStorage.removeItem('user');\r\n          stateStore.setStateSlice('auth', { \r\n            isAuthenticated: false, \r\n            user: null, \r\n            sessionId: null \r\n          });\r\n          eventBus.publish(EVENTS.USER_LOGOUT, {});\r\n        } else {\r\n          eventBus.publish(EVENTS.MODAL_OPEN, { type: 'login' });\r\n        }\r\n      });\r\n    }\r\n\r\n    // Bind other global UI elements if needed\r\n    const groupFilter = document.getElementById('groupFilter') as HTMLSelectElement;\r\n    if (groupFilter) {\r\n      // Populate and bind group filter logic here if needed\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle window resize\r\n   */\r\n  private handleResize(): void {\r\n    // Trigger map redraw\r\n    eventBus.publish(EVENTS.GROUP_FILTER_CHANGED, \r\n      stateStore.getStateSlice('ui').selectedGroup\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Update user info in UI\r\n   */\r\n  private updateUserInfo(user: any): void {\r\n    const userInfoEl = document.getElementById('userInfo');\r\n    const authBtnEl = document.getElementById('authBtn');\r\n    \r\n    if (userInfoEl && user) {\r\n      const balance = ((user.deposit || 0) + (user.bonus || 0)).toFixed(2);\r\n      userInfoEl.innerHTML = `<i class=\"fas fa-user\"></i> ${user.nickname || ''} \u2022 <i class=\"fas fa-wallet\" style=\"font-size:0.75rem;\"></i> ${balance}\u20AC`;\r\n    }\r\n    \r\n    if (authBtnEl) {\r\n      authBtnEl.innerHTML = '<i class=\"fas fa-sign-out-alt\"></i> <span class=\"hide-mobile\">Logout</span>';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear user info from UI\r\n   */\r\n  private clearUserInfo(): void {\r\n    const userInfoEl = document.getElementById('userInfo');\r\n    const authBtnEl = document.getElementById('authBtn');\r\n    \r\n    if (userInfoEl) {\r\n      userInfoEl.innerHTML = '';\r\n    }\r\n    \r\n    if (authBtnEl) {\r\n      authBtnEl.innerHTML = '<i class=\"fas fa-user-circle\"></i> <span class=\"hide-mobile\">Login</span>';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open modal\r\n   */\r\n  private openModal(type: string, message?: string): void {\r\n    const modalEl = document.getElementById(`${type}Modal`) || \r\n                   document.getElementById(type);\r\n    \r\n    if (modalEl) {\r\n      modalEl.style.display = 'flex';\r\n      \r\n      // Set message if provided\r\n      if (message && type === 'login') {\r\n        const errorEl = document.getElementById('loginError');\r\n        if (errorEl) {\r\n          errorEl.textContent = message;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close modal\r\n   */\r\n  private closeModal(type: string): void {\r\n    const modalEl = document.getElementById(`${type}Modal`) || \r\n                   document.getElementById(type);\r\n    \r\n    if (modalEl) {\r\n      modalEl.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error message\r\n   */\r\n  private showError(message: string): void {\r\n    eventBus.publish(EVENTS.TOAST_SHOW, {\r\n      type: 'error',\r\n      message\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle errors\r\n   */\r\n  private handleError(error: any): void {\r\n    console.error('App error:', error);\r\n    this.showError(error.message || 'An error occurred');\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  private cleanup(): void {\r\n    // Destroy components\r\n    this.components.forEach(component => {\r\n      if (component && typeof component.destroy === 'function') {\r\n        component.destroy();\r\n      }\r\n    });\r\n    this.components = [];\r\n  }\r\n\r\n  /**\r\n   * Get current state\r\n   */\r\n  public getState(): State {\r\n    return stateStore.getState();\r\n  }\r\n\r\n  /**\r\n   * Add component to app\r\n   */\r\n  public addComponent(component: BaseComponent): void {\r\n    this.components.push(component);\r\n  }\r\n\r\n  /**\r\n   * Remove component from app\r\n   */\r\n  public removeComponent(component: BaseComponent): void {\r\n    const index = this.components.indexOf(component);\r\n    if (index > -1) {\r\n      this.components.splice(index, 1);\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n\r\n// Create and export singleton instance\r\nexport const app = new App();", "/**\r\n * Base Component class implementing common functionality\r\n * Provides lifecycle hooks and event handling\r\n */\r\n\r\nimport { eventBus, EventBus, EventType } from '../events/EventBus.ts';\r\nimport { stateStore, State, selectors } from '../state/StateStore.ts';\r\n\r\n// DOM types for Deno\r\ndeclare global {\r\n  interface Document {\r\n    createElement(tagName: string): HTMLElement;\r\n    getElementById(id: string): HTMLElement | null;\r\n    querySelector(selector: string): HTMLElement | null;\r\n    querySelectorAll(selector: string): NodeListOf<HTMLElement>;\r\n    head: HTMLHeadElement;\r\n    documentElement: HTMLElement;\r\n    body: HTMLElement;\r\n    readyState: string;\r\n    activeElement: HTMLElement | null;\r\n    addEventListener(type: string, listener: EventListener): void;\r\n    removeEventListener(type: string, listener: EventListener): void;\r\n  }\r\n  \r\n  interface HTMLElement {\r\n    innerHTML: string;\r\n    textContent: string;\r\n    style: CSSStyleDeclaration;\r\n    id: string;\r\n    className: string;\r\n    parentNode: Node | null;\r\n    firstElementChild: HTMLElement | null;\r\n    querySelector(selector: string): HTMLElement | null;\r\n    querySelectorAll(selector: string): NodeListOf<HTMLElement>;\r\n    appendChild(node: Node): Node;\r\n    removeChild(node: Node): Node;\r\n    getBoundingClientRect(): DOMRect;\r\n    addEventListener(type: string, listener: EventListener): void;\r\n    removeEventListener(type: string, listener: EventListener): void;\r\n    getAttribute(name: string): string | null;\r\n    setAttribute(name: string, value: string): void;\r\n    removeAttribute(name: string): void;\r\n    classList: DOMTokenList;\r\n    focus(): void;\r\n    blur(): void;\r\n  }\r\n  \r\n  interface DOMTokenList {\r\n    add(token: string): void;\r\n    remove(token: string): void;\r\n    contains(token: string): boolean;\r\n  }\r\n  \r\n  interface HTMLCanvasElement extends HTMLElement {\r\n    width: number;\r\n    height: number;\r\n    getContext(contextId: string): CanvasRenderingContext2D | null;\r\n  }\r\n  \r\n  interface CanvasRenderingContext2D {\r\n    clearRect(x: number, y: number, width: number, height: number): void;\r\n    fillRect(x: number, y: number, width: number, height: number): void;\r\n    strokeRect(x: number, y: number, width: number, height: number): void;\r\n    beginPath(): void;\r\n    closePath(): void;\r\n    moveTo(x: number, y: number): void;\r\n    lineTo(x: number, y: number): void;\r\n    arcTo(x1: number, y1: number, x2: number, y2: number, radius: number): void;\r\n    arc(x: number, y: number, radius: number, startAngle: number, endAngle: number, anticlockwise?: boolean): void;\r\n    fill(): void;\r\n    stroke(): void;\r\n    setTransform(a: number, b: number, c: number, d: number, e: number, f: number): void;\r\n    fillStyle: string | any;\r\n    strokeStyle: string | any;\r\n    lineWidth: number;\r\n    font: string;\r\n    measureText(text: string): TextMetrics;\r\n    fillText(text: string, x: number, y: number, maxWidth?: number): void;\r\n    globalAlpha: number;\r\n    textBaseline: string;\r\n  }\r\n  \r\n  interface TextMetrics {\r\n    width: number;\r\n  }\r\n  \r\n  interface DOMRect {\r\n    width: number;\r\n    height: number;\r\n    top: number;\r\n    left: number;\r\n    right: number;\r\n    bottom: number;\r\n  }\r\n  \r\n  interface Node {\r\n    parentNode: Node | null;\r\n    removeChild(node: Node): Node;\r\n  }\r\n  \r\n  interface NodeListOf<TNode extends Node> {\r\n    [index: number]: TNode;\r\n    length: number;\r\n    forEach(callbackfn: (value: TNode, key: number, parent: NodeListOf<TNode>) => void): void;\r\n  }\r\n  \r\n  interface CSSStyleDeclaration {\r\n    [property: string]: string;\r\n  }\r\n  \r\n  interface HTMLHeadElement extends HTMLElement {\r\n    appendChild(node: Node): Node;\r\n    removeChild(node: Node): Node;\r\n  }\r\n  \r\n  interface HTMLFormElement extends HTMLElement {\r\n    elements: HTMLFormControlsCollection;\r\n    submit(): void;\r\n    reset(): void;\r\n  }\r\n  \r\n  interface HTMLInputElement extends HTMLElement {\r\n    value: string;\r\n    type: string;\r\n    checked: boolean;\r\n    disabled: boolean;\r\n    min: string;\r\n    max: string;\r\n    focus(): void;\r\n    blur(): void;\r\n  }\r\n  \r\n  interface HTMLButtonElement extends HTMLElement {\r\n    disabled: boolean;\r\n    type: string;\r\n  }\r\n  \r\n  interface HTMLSelectElement extends HTMLElement {\r\n    options: HTMLCollection;\r\n    selectedOptions: HTMLCollection;\r\n    value: string;\r\n    multiple: boolean;\r\n  }\r\n  \r\n  interface HTMLTextAreaElement extends HTMLElement {\r\n    value: string;\r\n    rows: number;\r\n  }\r\n  \r\n  interface HTMLOptionElement extends HTMLElement {\r\n    value: string;\r\n    text: string;\r\n    selected: boolean;\r\n  }\r\n  \r\n  interface HTMLCollection {\r\n    [index: number]: HTMLElement;\r\n    length: number;\r\n    item(index: number): HTMLElement | null;\r\n  }\r\n  \r\n  interface HTMLFormControlsCollection {\r\n    namedItem(name: string): HTMLElement | null;\r\n    [index: number]: HTMLElement;\r\n    length: number;\r\n  }\r\n  \r\n  interface Window {\r\n    devicePixelRatio?: number;\r\n    innerWidth: number;\r\n    innerHeight: number;\r\n    addEventListener(type: string, listener: EventListener): void;\r\n    removeEventListener(type: string, listener: EventListener): void;\r\n    requestAnimationFrame(callback: FrameRequestCallback): number;\r\n    cancelAnimationFrame(id: number): void;\r\n    setTimeout(callback: Function, delay: number): number;\r\n    clearTimeout(id: number): void;\r\n    setInterval(callback: Function, delay: number): number;\r\n    clearInterval(id: number): void;\r\n  }\r\n  \r\n  interface Event {\r\n    clientX: number;\r\n    clientY: number;\r\n    ctrlKey: boolean;\r\n    metaKey: boolean;\r\n  }\r\n  \r\n  interface MouseEvent extends Event {\r\n    clientX: number;\r\n    clientY: number;\r\n    ctrlKey: boolean;\r\n    metaKey: boolean;\r\n  }\r\n  \r\n  interface EventListener {\r\n    (evt: Event): void;\r\n  }\r\n  \r\n  interface FrameRequestCallback {\r\n    (time: number): void;\r\n  }\r\n  \r\n  interface CSSStyleRule {\r\n    style: CSSStyleDeclaration;\r\n  }\r\n  \r\n  interface CSSStyleSheet {\r\n    cssRules?: CSSRuleList;\r\n  }\r\n  \r\n  interface CSSRuleList {\r\n    [index: number]: CSSStyleRule;\r\n    length: number;\r\n  }\r\n  \r\n  interface Element {\r\n    firstElementChild: Element | null;\r\n    getBoundingClientRect(): DOMRect;\r\n  }\r\n  \r\n  function getComputedStyle(element: Element): CSSStyleDeclaration;\r\n  \r\n  const document: Document;\r\n  // const window: Window; // Already available globally\r\n}\r\n\r\nexport interface ComponentConfig {\r\n  element?: HTMLElement | string;\r\n  template?: string;\r\n  styles?: string;\r\n  props?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Base Component class\r\n */\r\nexport abstract class BaseComponent {\r\n  protected element: HTMLElement;\r\n  protected children: BaseComponent[] = [];\r\n  protected eventUnsubscribers: (() => void)[] = [];\r\n  protected stateUnsubscribers: (() => void)[] = [];\r\n  protected props: Record<string, any> = {};\r\n  protected isDestroyed = false;\r\n\r\n  constructor(config: ComponentConfig) {\r\n    // Create or get element\r\n    if (typeof config.element === 'string') {\r\n      this.element = document.querySelector(config.element) as HTMLElement;\r\n      if (!this.element) {\r\n        throw new Error(`Element not found: ${config.element}`);\r\n      }\r\n    } else if (config.element) {\r\n      this.element = config.element;\r\n    } else {\r\n      this.element = this.createElement();\r\n    }\r\n\r\n    // Set props\r\n    this.props = config.props || {};\r\n\r\n    // Apply template if provided\r\n    if (config.template) {\r\n      this.element.innerHTML = config.template;\r\n    }\r\n\r\n    // Apply styles if provided\r\n    if (config.styles) {\r\n      this.applyStyles(config.styles);\r\n    }\r\n\r\n    // Initialize component\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Create element from template\r\n   */\r\n  protected createElement(): HTMLElement {\r\n    const template = this.getTemplate();\r\n    if (!template) {\r\n      return document.createElement('div');\r\n    }\r\n\r\n    const div = document.createElement('div');\r\n    div.innerHTML = template.trim();\r\n    return div.firstElementChild as HTMLElement || div;\r\n  }\r\n\r\n  /**\r\n   * Get component template - to be overridden by subclasses\r\n   */\r\n  protected getTemplate(): string {\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Apply styles to component\r\n   */\r\n  protected applyStyles(styles: string): void {\r\n    if (this.element.id) {\r\n      // Create style element if not exists\r\n      let styleEl = document.getElementById(`style-${this.element.id}`);\r\n      if (!styleEl) {\r\n        styleEl = document.createElement('style');\r\n        styleEl.id = `style-${this.element.id}`;\r\n        document.head.appendChild(styleEl);\r\n      }\r\n      styleEl.textContent = styles;\r\n    } else {\r\n      // For components without ID, use scoped styles\r\n      const styleEl = document.createElement('style');\r\n      styleEl.textContent = styles;\r\n      document.head.appendChild(styleEl);\r\n      this.eventUnsubscribers.push(() => {\r\n        document.head.removeChild(styleEl);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize component - called after construction\r\n   */\r\n  protected init(): void {\r\n    this.bindEvents();\r\n    this.subscribeToState();\r\n    this.subscribeToEvents();\r\n    this.onInit();\r\n  }\r\n\r\n  /**\r\n   * Bind DOM events - to be overridden by subclasses\r\n   */\r\n  protected bindEvents(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes - to be overridden by subclasses\r\n   */\r\n  protected subscribeToState(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Subscribe to event bus - to be overridden by subclasses\r\n   */\r\n  protected subscribeToEvents(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Component initialization hook - called after all setup\r\n   */\r\n  protected onInit(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Component destruction hook - called before cleanup\r\n   */\r\n  protected onDestroy(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  protected subscribeToStateSlice<K extends keyof State>(\r\n    key: K,\r\n    callback: (value: State[K]) => void\r\n  ): void {\r\n    const unsubscribe = stateStore.subscribeToSlice(key, callback);\r\n    this.stateUnsubscribers.push(unsubscribe);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to event bus\r\n   */\r\n  protected subscribeToEvent<T>(\r\n    event: EventType,\r\n    callback: (data: T) => void\r\n  ): void {\r\n    const unsubscribe = eventBus.subscribe(event, callback);\r\n    this.eventUnsubscribers.push(unsubscribe);\r\n  }\r\n\r\n  /**\r\n   * Get current state\r\n   */\r\n  protected getState(): State {\r\n    return stateStore.getState();\r\n  }\r\n\r\n  /**\r\n   * Get specific state slice\r\n   */\r\n  protected getStateSlice<K extends keyof State>(key: K): State[K] {\r\n    return stateStore.getStateSlice(key);\r\n  }\r\n\r\n  /**\r\n   * Update state\r\n   */\r\n  protected setState(updates: Partial<State>): void {\r\n    stateStore.setState(updates);\r\n  }\r\n\r\n  /**\r\n   * Update state slice\r\n   */\r\n  protected setStateSlice<K extends keyof State>(\r\n    key: K,\r\n    value: State[K]\r\n  ): void {\r\n    stateStore.setStateSlice(key, value);\r\n  }\r\n\r\n  /**\r\n   * Publish event to event bus\r\n   */\r\n  protected publishEvent<T>(event: EventType, data: T): void {\r\n    eventBus.publish(event, data);\r\n  }\r\n\r\n  /**\r\n   * Find child element\r\n   */\r\n  protected findElement<T extends HTMLElement = HTMLElement>(\r\n    selector: string\r\n  ): T | null {\r\n    return this.element.querySelector(selector) as T | null;\r\n  }\r\n\r\n  /**\r\n   * Find child elements\r\n   */\r\n  protected findElements<T extends HTMLElement = HTMLElement>(\r\n    selector: string\r\n  ): T[] {\r\n    return Array.from(this.element.querySelectorAll(selector)) as T[];\r\n  }\r\n\r\n  /**\r\n   * Add child component\r\n   */\r\n  protected addChild(child: BaseComponent): void {\r\n    this.children.push(child);\r\n    this.element.appendChild(child.element);\r\n  }\r\n\r\n  /**\r\n   * Remove child component\r\n   */\r\n  protected removeChild(child: BaseComponent): void {\r\n    const index = this.children.indexOf(child);\r\n    if (index > -1) {\r\n      this.children.splice(index, 1);\r\n      child.destroy();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show component\r\n   */\r\n  public show(): void {\r\n    this.element.style.display = '';\r\n    this.onShow();\r\n  }\r\n\r\n  /**\r\n   * Hide component\r\n   */\r\n  public hide(): void {\r\n    this.element.style.display = 'none';\r\n    this.onHide();\r\n  }\r\n\r\n  /**\r\n   * Show/hide component hook\r\n   */\r\n  protected onShow(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  protected onHide(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Set component property\r\n   */\r\n  public setProp(key: string, value: any): void {\r\n    this.props[key] = value;\r\n    this.onPropChange(key, value);\r\n  }\r\n\r\n  /**\r\n   * Get component property\r\n   */\r\n  public getProp<T = any>(key: string): T {\r\n    return this.props[key];\r\n  }\r\n\r\n  /**\r\n   * Property change hook\r\n   */\r\n  protected onPropChange(key: string, value: any): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Update component rendering\r\n   */\r\n  protected render(): void {\r\n    this.beforeRender();\r\n    this.doRender();\r\n    this.afterRender();\r\n  }\r\n\r\n  /**\r\n   * Before render hook\r\n   */\r\n  protected beforeRender(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Do actual rendering - to be overridden by subclasses\r\n   */\r\n  protected doRender(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * After render hook\r\n   */\r\n  protected afterRender(): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  /**\r\n   * Destroy component and clean up\r\n   */\r\n  public destroy(): void {\r\n    if (this.isDestroyed) return;\r\n\r\n    this.onDestroy();\r\n\r\n    // Destroy children\r\n    this.children.forEach(child => child.destroy());\r\n    this.children = [];\r\n\r\n    // Unsubscribe from events\r\n    this.eventUnsubscribers.forEach(unsubscribe => unsubscribe());\r\n    this.eventUnsubscribers = [];\r\n\r\n    // Unsubscribe from state\r\n    this.stateUnsubscribers.forEach(unsubscribe => unsubscribe());\r\n    this.stateUnsubscribers = [];\r\n\r\n    // Remove element from DOM\r\n    if (this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n  }\r\n\r\n  /**\r\n   * Check if component is destroyed\r\n   */\r\n  public isComponentDestroyed(): boolean {\r\n    return this.isDestroyed;\r\n  }\r\n}\r\n\r\n/**\r\n * Functional component helper\r\n */\r\nexport function createComponent<P extends Record<string, any> = Record<string, any>>(\r\n  config: ComponentConfig & {\r\n    render: (props: P) => string;\r\n    onMount?: (element: HTMLElement, props: P) => (() => void) | void;\r\n    onUpdate?: (element: HTMLElement, props: P) => void;\r\n    onDestroy?: (element: HTMLElement) => void;\r\n  }\r\n): BaseComponent {\r\n  class FunctionalComponent extends BaseComponent {\r\n    private cleanup: (() => void) | null = null;\r\n\r\n    protected override getTemplate(): string {\r\n      return config.render(this.props as P);\r\n    }\r\n\r\n    protected override onInit(): void {\r\n      if (config.onMount) {\r\n        this.cleanup = config.onMount(this.element, this.props as P) || null;\r\n      }\r\n    }\r\n\r\n    protected override onPropChange(key: string, value: any): void {\r\n      if (config.onUpdate) {\r\n        config.onUpdate(this.element, this.props as P);\r\n      }\r\n    }\r\n\r\n    protected override onDestroy(): void {\r\n      if (this.cleanup) {\r\n        this.cleanup();\r\n      }\r\n      if (config.onDestroy) {\r\n        config.onDestroy(this.element);\r\n      }\r\n    }\r\n  }\r\n\r\n  return new FunctionalComponent(config);\r\n}", "/**\r\n * Map Component for visualizing hosts\r\n * Handles canvas rendering and user interactions\r\n */\r\n\r\nimport { BaseComponent } from '../components/BaseComponent.ts';\r\nimport { stateStore, State, selectors } from '../state/StateStore.ts';\r\nimport { eventBus, EVENTS } from '../events/EventBus.ts';\r\n\r\n/**\r\n * Map Component Class\r\n */\r\nexport class MapComponent extends BaseComponent {\r\n  private canvas: HTMLCanvasElement | null = null;\r\n  private ctx: CanvasRenderingContext2D | null = null;\r\n  private animationFrameId: number | null = null;\r\n  private resizeTimeout: number | null = null;\r\n\r\n  constructor() {\r\n    super({\r\n      element: '#mapCard'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize component\r\n   */\r\n  protected override onInit(): void {\r\n    this.canvas = this.findElement('#map') as HTMLCanvasElement;\r\n    if (!this.canvas) {\r\n      console.error('Map canvas not found');\r\n      return;\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext('2d');\r\n    if (!this.ctx) {\r\n      console.error('Failed to get canvas context');\r\n      return;\r\n    }\r\n\r\n    this.setupCanvas();\r\n    this.bindEvents();\r\n    this.subscribeToState();\r\n    this.draw();\r\n  }\r\n\r\n  /**\r\n   * Setup canvas\r\n   */\r\n  private setupCanvas(): void {\r\n    if (!this.canvas || !this.ctx) return;\r\n\r\n    this.resizeCanvas();\r\n    this.setupCanvasEvents();\r\n  }\r\n\r\n  /**\r\n   * Resize canvas\r\n   */\r\n  private resizeCanvas(): void {\r\n    if (!this.canvas) return;\r\n\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    const dpr = window.devicePixelRatio || 1;\r\n    this.canvas.width = Math.floor(rect.width * dpr);\r\n    this.canvas.height = Math.floor(rect.height * dpr);\r\n    \r\n    if (this.ctx) {\r\n      this.ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup canvas events\r\n   */\r\n  private setupCanvasEvents(): void {\r\n    if (!this.canvas) return;\r\n\r\n    // Mouse move event\r\n    this.canvas.addEventListener('mousemove', (e) => {\r\n      this.handleMouseMove(e);\r\n    });\r\n\r\n    // Click event\r\n    this.canvas.addEventListener('click', (e) => {\r\n      this.handleClick(e);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Bind DOM events\r\n   */\r\n  protected override bindEvents(): void {\r\n    // Window resize\r\n    window.addEventListener('resize', () => {\r\n      this.handleResize();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  protected override subscribeToState(): void {\r\n    // Hosts data\r\n    this.subscribeToStateSlice('hosts', () => {\r\n      this.draw();\r\n    });\r\n\r\n    // Bookings data\r\n    this.subscribeToStateSlice('bookings', () => {\r\n      this.draw();\r\n    });\r\n\r\n    // UI state\r\n    this.subscribeToStateSlice('ui', (ui) => {\r\n      this.draw();\r\n    });\r\n\r\n    // Map state\r\n    this.subscribeToStateSlice('map', () => {\r\n      this.draw();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle mouse move\r\n   */\r\n  private handleMouseMove(e: MouseEvent): void {\r\n    if (!this.canvas) return;\r\n\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n    const host = this.getHostAtPosition(x, y);\r\n    const state = this.getState();\r\n    \r\n    // Update hovered host\r\n    if (state.ui.hoveredHost !== host) {\r\n      this.setStateSlice('ui', {\r\n        ...state.ui,\r\n        hoveredHost: host\r\n      });\r\n    }\r\n\r\n    // Update cursor\r\n    this.canvas.style.cursor = host ? 'pointer' : 'default';\r\n\r\n    // Show tooltip\r\n    this.showTooltip(host, e.clientX, e.clientY);\r\n  }\r\n\r\n  /**\r\n   * Handle click\r\n   */\r\n  private handleClick(e: MouseEvent): void {\r\n    if (!this.canvas) return;\r\n\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n    const host = this.getHostAtPosition(x, y);\r\n    \r\n    if (!host) return;\r\n\r\n    const state = this.getState();\r\n    \r\n    if (e.ctrlKey || e.metaKey) {\r\n      // Multi-select mode\r\n      if (!host.session) {\r\n        const selectedHosts = new Set(state.ui.selectedHosts);\r\n        if (selectedHosts.has(host.id)) {\r\n          selectedHosts.delete(host.id);\r\n        } else {\r\n          selectedHosts.add(host.id);\r\n        }\r\n        \r\n        this.setStateSlice('ui', {\r\n          ...state.ui,\r\n          selectedHosts\r\n        });\r\n        \r\n        this.publishEvent(EVENTS.BOOKING_SELECTED, {\r\n          hostIds: Array.from(selectedHosts)\r\n        });\r\n      }\r\n    } else {\r\n      // Single selection - open PC info modal\r\n      this.publishEvent(EVENTS.MODAL_OPEN, {\r\n        type: 'pcInfo',\r\n        data: host\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle window resize\r\n   */\r\n  private handleResize(): void {\r\n    if (this.resizeTimeout) {\r\n      clearTimeout(this.resizeTimeout);\r\n    }\r\n\r\n    this.resizeTimeout = setTimeout(() => {\r\n      this.setStateSlice('map', {\r\n        ...this.getStateSlice('map'),\r\n        // Reset fitted flag to recalculate layout\r\n      });\r\n      this.draw();\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Get host at position\r\n   */\r\n  private getHostAtPosition(x: number, y: number): any {\r\n    const state = this.getState();\r\n    const hosts = this.getFilteredHosts(state.hosts, state.ui.selectedGroup);\r\n    const bounds = this.computeBounds(hosts);\r\n    \r\n    for (const host of hosts) {\r\n      if (!Number.isFinite(host.coord_x) || !Number.isFinite(host.coord_y)) continue;\r\n      \r\n      const gx = (host.coord_x - bounds.minX);\r\n      const gy = (host.coord_y - bounds.minY);\r\n      const mapState = state.map;\r\n      const scale = mapState.scale;\r\n      const offsetX = mapState.offsetX;\r\n      const offsetY = mapState.offsetY;\r\n      \r\n      const cx = offsetX + gx * scale + scale / 2;\r\n      const cy = offsetY + gy * scale + scale / 2;\r\n      const w = Math.max(scale - 8, 36);\r\n      const h = Math.max(scale - 8, 38);\r\n      const hx = cx - w / 2;\r\n      const hy = cy - h / 2;\r\n      \r\n      if (x >= hx && x <= hx + w && y >= hy && y <= hy + h) {\r\n        return host;\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get filtered hosts\r\n   */\r\n  private getFilteredHosts(hosts: any[], selectedGroup: string): any[] {\r\n    if (!selectedGroup) return hosts;\r\n    return hosts.filter(h => h.group?.id === selectedGroup);\r\n  }\r\n\r\n  /**\r\n   * Compute bounds\r\n   */\r\n  private computeBounds(hosts: any[]): { minX: number; minY: number; maxX: number; maxY: number } {\r\n    const withCoords = hosts.filter(h => \r\n      Number.isFinite(h.coord_x) && Number.isFinite(h.coord_y)\r\n    );\r\n    \r\n    if (!withCoords.length) {\r\n      return { minX: 0, minY: 0, maxX: 1, maxY: 1 };\r\n    }\r\n    \r\n    const xs = withCoords.map(h => h.coord_x);\r\n    const ys = withCoords.map(h => h.coord_y);\r\n    \r\n    return {\r\n      minX: Math.min(...xs),\r\n      minY: Math.min(...ys),\r\n      maxX: Math.max(...xs),\r\n      maxY: Math.max(...ys)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Fit to view\r\n   */\r\n  private fitToView(): void {\r\n    const state = this.getState();\r\n    const hosts = this.getFilteredHosts(state.hosts, state.ui.selectedGroup);\r\n    const bounds = this.computeBounds(hosts);\r\n    const mapState = state.map;\r\n    const padding = mapState.padding;\r\n    \r\n    if (!this.canvas) return;\r\n    \r\n    const rect = this.canvas.getBoundingClientRect();\r\n    const widthCells = (bounds.maxX - bounds.minX + 1) || 1;\r\n    const heightCells = (bounds.maxY - bounds.minY + 1) || 1;\r\n    const sx = (rect.width - padding * 2) / widthCells;\r\n    const sy = (rect.height - padding * 2) / heightCells;\r\n    const scale = Math.max(28, Math.floor(Math.min(sx, sy)));\r\n    \r\n    const gridW = widthCells * scale;\r\n    const gridH = heightCells * scale;\r\n    const offsetX = padding + Math.floor((rect.width - padding * 2 - gridW) / 2);\r\n    const offsetY = padding + Math.floor((rect.height - padding * 2 - gridH) / 2);\r\n    \r\n    this.setStateSlice('map', {\r\n      ...mapState,\r\n      scale,\r\n      offsetX,\r\n      offsetY\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get color for host\r\n   */\r\n  private getColorForHost(host: any): string {\r\n    const state = this.getState();\r\n    \r\n    if (host.session) {\r\n      return getComputedStyle(document.documentElement).getPropertyValue('--busy').trim() || '#3b82f6';\r\n    }\r\n    \r\n    const hasBooking = state.bookings.some(b => \r\n      b.hosts.some((bh: any) => bh.id == host.id)\r\n    );\r\n    \r\n    if (hasBooking) {\r\n      return getComputedStyle(document.documentElement).getPropertyValue('--booked').trim() || '#f59e0b';\r\n    }\r\n    \r\n    return getComputedStyle(document.documentElement).getPropertyValue('--free').trim() || '#10b981';\r\n  }\r\n\r\n  /**\r\n   * Get status emoji\r\n   */\r\n  private getStatusEmoji(host: any): string {\r\n    const state = this.getState();\r\n    \r\n    if (host.session) return '\u25CF';\r\n    \r\n    const now = new Date();\r\n    const hasActiveBooking = state.bookings.some(b => {\r\n      const bookingStart = new Date(b.from);\r\n      const bookingEnd = new Date(b.to);\r\n      return b.hosts.some((bh: any) => bh.id == host.id) && \r\n             bookingStart <= now && bookingEnd > now;\r\n    });\r\n    \r\n    if (hasActiveBooking) return '\u25C6';\r\n    \r\n    const hasFutureBooking = state.bookings.some(b => {\r\n      const bookingStart = new Date(b.from);\r\n      return b.hosts.some((bh: any) => bh.id == host.id) && bookingStart > now;\r\n    });\r\n    \r\n    if (hasFutureBooking) return '\u25C7';\r\n    \r\n    return '\u25CB';\r\n  }\r\n\r\n  /**\r\n   * Show tooltip\r\n   */\r\n  private showTooltip(host: any | null, x: number, y: number): void {\r\n    const tooltip = document.getElementById('tooltip');\r\n    if (!tooltip) return;\r\n\r\n    if (!host) {\r\n      tooltip.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    let tooltipText = `${this.getStatusEmoji(host)} ${host.alias ?? 'Seat ' + host.id}`;\r\n    if (host.group?.title) tooltipText += ` \u2022 ${host.group.title}`;\r\n\r\n    const state = this.getState();\r\n    const now = new Date();\r\n    \r\n    const activeBooking = state.bookings.find(b => {\r\n      const bookingStart = new Date(b.from);\r\n      const bookingEnd = new Date(b.to);\r\n      return b.hosts.some((bh: any) => bh.id == host.id) && \r\n             bookingStart <= now && bookingEnd > now;\r\n    });\r\n    \r\n    if (activeBooking) {\r\n      const fromDate = new Date(activeBooking.from);\r\n      const toDate = new Date(activeBooking.to);\r\n      const dateStr = fromDate.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });\r\n      const fromTime = fromDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\r\n      const toTime = toDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\r\n      tooltipText += `<br>\u25C6 Booked: ${dateStr}, ${fromTime} - ${toTime}`;\r\n      if (activeBooking.client?.nickname) {\r\n        tooltipText += ` (${activeBooking.client.nickname})`;\r\n      }\r\n    } else {\r\n      const futureBooking = state.bookings.find(b => {\r\n        const bookingStart = new Date(b.from);\r\n        return b.hosts.some((bh: any) => bh.id == host.id) && bookingStart > now;\r\n      });\r\n      \r\n      if (futureBooking) {\r\n        const fromDate = new Date(futureBooking.from);\r\n        const dateStr = fromDate.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });\r\n        const fromTime = fromDate.toLocaleTimeString('en-US', { \r\n          hour: '2-digit', minute: '2-digit', hour12: false \r\n        });\r\n        tooltipText += `<br>\u25C7 Future: ${dateStr}, ${fromTime}`;\r\n        if (futureBooking.client?.nickname) {\r\n          tooltipText += ` (${futureBooking.client.nickname})`;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (host.session) {\r\n      tooltipText += host.session.user \r\n        ? `<br>\u25CF Playing: ${host.session.user}` \r\n        : `<br>\u25CF In Use`;\r\n      \r\n      let timeLeft = null;\r\n      if (host.session.time_left && host.session.time_left > 0) {\r\n        timeLeft = host.session.time_left;\r\n      } else if (host.session.started_at && host.session.duration) {\r\n        const start = new Date(host.session.started_at);\r\n        const end = new Date(start.getTime() + host.session.duration * 1000);\r\n        timeLeft = Math.max(0, Math.floor((end.getTime() - Date.now()) / 1000));\r\n      }\r\n      \r\n      if (timeLeft && timeLeft > 0) {\r\n        const hours = Math.floor(timeLeft / 3600);\r\n        const minutes = Math.floor((timeLeft % 3600) / 60);\r\n        tooltipText += hours > 0 \r\n          ? `<br>\u23F1 Remaining: ${hours}h ${minutes}m` \r\n          : `<br>\u23F1 Remaining: ${minutes}m`;\r\n      }\r\n    }\r\n\r\n    tooltip.innerHTML = tooltipText;\r\n    tooltip.style.display = 'block';\r\n\r\n    // Position tooltip\r\n    requestAnimationFrame(() => {\r\n      const tooltipRect = tooltip.getBoundingClientRect();\r\n      const offset = 20;\r\n      \r\n      let tooltipX = x + offset;\r\n      let tooltipY = y + offset;\r\n      \r\n      if (tooltipX + tooltipRect.width > window.innerWidth - 10) {\r\n        tooltipX = x - tooltipRect.width - offset;\r\n      }\r\n      \r\n      if (tooltipY + tooltipRect.height > window.innerHeight - 10) {\r\n        tooltipY = y - tooltipRect.height - offset;\r\n      }\r\n      \r\n      tooltip.style.left = tooltipX + 'px';\r\n      tooltip.style.top = tooltipY + 'px';\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Draw the map\r\n   */\r\n  private draw(): void {\r\n    if (!this.canvas || !this.ctx) return;\r\n\r\n    // Cancel previous animation frame\r\n    if (this.animationFrameId) {\r\n      cancelAnimationFrame(this.animationFrameId);\r\n    }\r\n\r\n    this.animationFrameId = requestAnimationFrame(() => {\r\n      this.resizeCanvas();\r\n      \r\n      const state = this.getState();\r\n      const hosts = this.getFilteredHosts(state.hosts, state.ui.selectedGroup);\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      \r\n      // Clear canvas\r\n      this.ctx.clearRect(0, 0, rect.width, rect.height);\r\n      this.ctx.fillStyle = '#07121b';\r\n      this.ctx.fillRect(0, 0, rect.width, rect.height);\r\n      \r\n      // Fit to view if needed\r\n      if (!this.draw._fittedOnce) { \r\n        this.fitToView(); \r\n        this.draw._fittedOnce = true; \r\n      }\r\n      \r\n      const bounds = this.computeBounds(hosts);\r\n      const mapState = state.map;\r\n      \r\n      // Draw grid\r\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.03)';\r\n      this.ctx.lineWidth = 1;\r\n      \r\n      for (let x = bounds.minX; x <= bounds.maxX + 1; x++) {\r\n        const px = mapState.offsetX + (x - bounds.minX) * mapState.scale;\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(px, mapState.offsetY);\r\n        this.ctx.lineTo(px, rect.height - mapState.offsetY);\r\n        this.ctx.stroke();\r\n      }\r\n      \r\n      for (let y = bounds.minY; y <= bounds.maxY + 1; y++) {\r\n        const py = mapState.offsetY + (y - bounds.minY) * mapState.scale;\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(mapState.offsetX, py);\r\n        this.ctx.lineTo(rect.width - mapState.offsetX, py);\r\n        this.ctx.stroke();\r\n      }\r\n      \r\n      // Draw hosts\r\n      this.ctx.textBaseline = 'middle';\r\n      this.ctx.font = '12px Inter, system-ui';\r\n      \r\n      for (const host of hosts) {\r\n        if (!Number.isFinite(host.coord_x) || !Number.isFinite(host.coord_y)) continue;\r\n        \r\n        const gx = (host.coord_x - bounds.minX);\r\n        const gy = (host.coord_y - bounds.minY);\r\n        const cx = mapState.offsetX + gx * mapState.scale + mapState.scale / 2;\r\n        const cy = mapState.offsetY + gy * mapState.scale + mapState.scale / 2;\r\n        const w = Math.max(mapState.scale - 8, 36);\r\n        const h = Math.max(mapState.scale - 8, 38);\r\n        const x = cx - w / 2;\r\n        const y = cy - h / 2;\r\n        \r\n        const isHovered = state.ui.hoveredHost && state.ui.hoveredHost.id === host.id;\r\n        const isSelected = state.ui.selectedHosts.has(host.id);\r\n        \r\n        // Draw host box\r\n        this.ctx.fillStyle = this.getColorForHost(host);\r\n        if (isHovered) this.ctx.globalAlpha = 0.85;\r\n        this.roundRect(x, y, w, h, 8);\r\n        this.ctx.fill();\r\n        this.ctx.globalAlpha = 1;\r\n        \r\n        // Draw selection border\r\n        if (isSelected) {\r\n          this.ctx.strokeStyle = '#00bcd4';\r\n          this.ctx.lineWidth = 3;\r\n          this.roundRect(x, y, w, h, 8);\r\n          this.ctx.stroke();\r\n        }\r\n        \r\n        // Draw status emoji\r\n        const emoji = this.getStatusEmoji(host);\r\n        this.ctx.font = '16px Arial';\r\n        this.ctx.fillStyle = '#ffffff';\r\n        const emojiWidth = this.ctx.measureText(emoji).width;\r\n        this.ctx.fillText(emoji, cx - emojiWidth / 2, cy - 8);\r\n        \r\n        // Draw host label\r\n        this.ctx.font = '11px Inter, system-ui';\r\n        this.ctx.fillStyle = '#061226';\r\n        const label = host.alias ?? '\u2014';\r\n        this.clipText(label, x + 8, cy + 8, w - 16);\r\n        \r\n        // Draw session info\r\n        if (host.session) {\r\n          this.ctx.fillStyle = 'rgba(184,195,211,0.9)';\r\n          let timeText = '';\r\n          \r\n          if (host.session.time_left && host.session.time_left > 0) {\r\n            const endTime = new Date(Date.now() + host.session.time_left * 1000);\r\n            timeText = '\u0434\u043E ' + endTime.toLocaleTimeString('en-US', { \r\n              hour: '2-digit', minute: '2-digit', hour12: false \r\n            });\r\n          } else if (host.session.started_at && host.session.duration) {\r\n            const start = new Date(host.session.started_at);\r\n            const end = new Date(start.getTime() + host.session.duration * 1000);\r\n            timeText = '\u0434\u043E ' + end.toLocaleTimeString('en-US', { \r\n              hour: '2-digit', minute: '2-digit', hour12: false \r\n            });\r\n          }\r\n          \r\n          if (timeText) {\r\n            this.clipText(timeText, x + 8, cy + 18, w - 16);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Draw rounded rectangle\r\n   */\r\n  private roundRect(x: number, y: number, w: number, h: number, r: number): void {\r\n    if (!this.ctx) return;\r\n    \r\n    const rr = Math.min(r, w / 2, h / 2);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(x + rr, y);\r\n    this.ctx.arcTo(x + w, y, x + w, y + h, rr);\r\n    this.ctx.arcTo(x + w, y + h, x, y + h, rr);\r\n    this.ctx.arcTo(x, y + h, x, y, rr);\r\n    this.ctx.arcTo(x, y, x + w, y, rr);\r\n    this.ctx.closePath();\r\n  }\r\n\r\n  /**\r\n   * Clip text to width\r\n   */\r\n  private clipText(text: string, x: number, midY: number, maxW: number): void {\r\n    if (!this.ctx) return;\r\n    \r\n    let t = String(text ?? \"\");\r\n    while (this.ctx.measureText(t).width > maxW && t.length > 1) {\r\n      t = t.slice(0, -1);\r\n    }\r\n    \r\n    if (t !== text && maxW > 10) {\r\n      t = t.slice(0, -1) + '\u2026';\r\n    }\r\n    \r\n    this.ctx.fillText(t, x, midY);\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  public destroy(): void {\r\n    if (this.resizeTimeout) {\r\n      clearTimeout(this.resizeTimeout);\r\n    }\r\n    \r\n    if (this.animationFrameId) {\r\n      cancelAnimationFrame(this.animationFrameId);\r\n    }\r\n    \r\n    // Hide tooltip\r\n    const tooltip = document.getElementById('tooltip');\r\n    if (tooltip) {\r\n      tooltip.style.display = 'none';\r\n    }\r\n    \r\n    super.destroy();\r\n  }\r\n}", "/**\r\n * Frontend Entry Point\r\n * Initializes the refactored frontend architecture\r\n */\r\n\r\nimport { app } from './modules/App.ts';\r\nimport { MapComponent } from './modules/MapComponent.ts';\r\n\r\n/**\r\n * Initialize the frontend application\r\n */\r\nfunction initializeFrontend(): void {\r\n  // Templates are already loaded by waitForDOM -> loadTemplates().then(...)\r\n  \r\n  // Initialize components\r\n  initializeComponents();\r\n  \r\n  // Mount app (bind global UI events)\r\n  app.mount();\r\n  \r\n  // Start the application\r\n  // App constructor automatically initializes itself\r\n}\r\n\r\n/**\r\n * Load HTML templates into the DOM\r\n */\r\nasync function loadTemplates(): Promise<void> {\r\n  // Load main template\r\n  try {\r\n    const mainTemplateResponse = await fetch('../templates/main.html');\r\n    const mainTemplate = await mainTemplateResponse.text();\r\n    \r\n    if (document.body) {\r\n      document.body.innerHTML = mainTemplate;\r\n    }\r\n    \r\n    // Load modal templates\r\n    const modalTemplatesResponse = await fetch('../templates/modals.html');\r\n    const modalTemplates = await modalTemplatesResponse.text();\r\n    \r\n    const modalContainer = document.createElement('div');\r\n    modalContainer.innerHTML = modalTemplates;\r\n    document.body.appendChild(modalContainer);\r\n  } catch (error) {\r\n    console.error('Failed to load templates:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize components\r\n */\r\nfunction initializeComponents(): void {\r\n  // Initialize map component\r\n  const mapComponent = new MapComponent();\r\n  \r\n  // Add component to app\r\n  app.addComponent(mapComponent);\r\n  \r\n  // Initialize other components here as they are created\r\n  // const sidebarComponent = new SidebarComponent();\r\n  // app.addComponent(sidebarComponent);\r\n  \r\n  // const modalComponent = new ModalComponent();\r\n  // app.addComponent(modalComponent);\r\n}\r\n\r\n/**\r\n * Wait for DOM to be ready\r\n */\r\nfunction waitForDOM(): void {\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      loadTemplates().then(initializeFrontend);\r\n    });\r\n  } else {\r\n    loadTemplates().then(initializeFrontend);\r\n  }\r\n}\r\n\r\n// Start the application\r\nwaitForDOM();\r\n\r\n// Export for external access\r\nexport { app, initializeFrontend };"],
  "mappings": "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",
  "names": ["EventBus", "_EventBus", "event", "callback", "data", "error", "eventBus", "EVENTS", "StateStore", "_StateStore", "key", "updates", "prevState", "value", "callback", "id", "error", "subscribers", "newState", "eventBus", "EVENTS", "target", "source", "output", "item", "stateStore", "ApiService", "baseUrl", "token", "options", "headers", "response", "eventBus", "EVENTS", "errorMessage", "errorData", "endpoint", "url", "contentType", "error", "data", "file", "additionalData", "formData", "key", "value", "apiService", "AuthApiService", "credentials", "HostApiService", "id", "BookingApiService", "bookingData", "GameApiService", "AchievementApiService", "PaymentApiService", "LeaderboardApiService", "authApi", "hostApi", "bookingApi", "gameApi", "achievementApi", "paymentApi", "leaderboardApi", "App", "error", "sessionId", "userStr", "user", "stateStore", "eventBus", "EVENTS", "data", "hosts", "bookings", "hostApi", "bookingApi", "achievements", "payments", "achievementApi", "paymentApi", "refreshBtn", "authBtn", "groupFilter", "userInfoEl", "authBtnEl", "balance", "type", "message", "modalEl", "errorEl", "component", "index", "app", "BaseComponent", "config", "template", "div", "styles", "styleEl", "key", "callback", "unsubscribe", "stateStore", "event", "eventBus", "updates", "value", "data", "selector", "child", "index", "MapComponent", "BaseComponent", "rect", "dpr", "ui", "x", "y", "host", "state", "selectedHosts", "EVENTS", "hosts", "bounds", "gx", "gy", "mapState", "scale", "offsetX", "offsetY", "cx", "cy", "w", "h", "hx", "hy", "selectedGroup", "withCoords", "xs", "ys", "padding", "widthCells", "heightCells", "sx", "sy", "gridW", "gridH", "b", "bh", "now", "bookingStart", "bookingEnd", "tooltip", "tooltipText", "activeBooking", "fromDate", "toDate", "dateStr", "fromTime", "toTime", "futureBooking", "timeLeft", "start", "end", "hours", "minutes", "tooltipRect", "offset", "tooltipX", "tooltipY", "px", "py", "isHovered", "isSelected", "emoji", "emojiWidth", "label", "timeText", "r", "rr", "text", "midY", "maxW", "t", "initializeFrontend", "initializeComponents", "app", "loadTemplates", "mainTemplate", "modalTemplates", "modalContainer", "error", "mapComponent", "MapComponent", "waitForDOM"]
}
